<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promosyon Quizleri</title>
    <style>
        /* index.html dosyasÄ±ndaki ilgili CSS stillerini buraya kopyalayacaÄŸÄ±z */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a1f44;
            color: #ffffff;
            padding: 20px;
        }

        .quiz-container {
            background: #142d5f;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .quiz-question {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #ffc107; /* SarÄ± */
        }

        .quiz-options {
            display: grid;
            gap: 10px;
        }

        .quiz-option {
            background: #0a1f44;
            border: 2px solid #1a3a6b;
            color: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            border-color: #ffc107;
            background: #1a3a6b;
        }

        .quiz-option.selected {
            border-color: #ffc107;
            background: #ffc107;
            color: #0a1f44;
        }

        .quiz-option.correct {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }

        .quiz-option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }

        .quiz-button {
            background: #ffc107;
            color: #0a1f44;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .quiz-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            background: #ffeb3b;
        }

        .quiz-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .score-display {
            background: #1a3a6b;
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #ffffff;
        }

        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
            background-color: #0a1f44; /* Koyu lacivert */
            color: #ffffff; /* Beyaz metin */
        }

    </style>
</head>
<body>
    <div class="quiz-container">
        <h3 style="margin-bottom: 20px; color: #ffc107;">ðŸŽ¯ Quizler</h3>
        
        <div class="quiz-category-tabs" style="display: flex; margin-bottom: 20px; border-radius: 10px; overflow: hidden;">
            <button class="quiz-category-tab active" id="tab-promosyon" onclick="showQuizCategory('promosyon')" style="flex: 1; padding: 10px; text-align: center; cursor: pointer; background: #ffc107; color: #0a1f44; font-weight: bold; transition: all 0.3s ease;">
                Promosyon Quizleri
            </button>
            <button class="quiz-category-tab" id="tab-saglayici" onclick="showQuizCategory('saglayici')" style="flex: 1; padding: 10px; text-align: center; cursor: pointer; background: #1a3a6b; color: #ffffff; font-weight: bold; transition: all 0.3s ease;">
                SaÄŸlayÄ±cÄ± Quizleri
            </button>
        </div>

        <div class="form-group" style="margin-bottom: 20px;">
            <label>Quiz Yapmak Ä°stediÄŸiniz Promosyonu SeÃ§in:</label>
            <select id="promo-select" onchange="loadQuiz()" style="width: 100%; padding: 10px; border: 1px solid #dee2e6; border-radius: 8px;">
                <option value="">Promosyon seÃ§in...</option>
            </select>
        </div>

        <div id="quiz-content" style="display: none;">
            <div class="quiz-question" id="quiz-question">
                Soru yÃ¼kleniyor...
            </div>
            <div class="quiz-options" id="quiz-options">
                <!-- SeÃ§enekler buraya yÃ¼klenecek -->
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="quiz-button" onclick="checkAnswer()" id="check-btn">CevabÄ± Kontrol Et</button>
                <button class="quiz-button" onclick="loadQuiz()" style="background: #ffeb3b; color: #0a1f44;">ðŸ”„ Yeni Soru</button>
            </div>
        </div>

        <div class="score-display" id="score-display" style="display: none;">
            <div id="score-text"></div>
        </div>
    </div>

    <script>
        let currentAnswer = -1;
        let currentQuiz = null;
        let regularPromos = []; // Normal promosyonlar
        let providerPromos = []; // SaÄŸlayÄ±cÄ± promosyonlarÄ±
        let activePromos = []; // Åžu an aktif olan promosyon listesi
        let currentQuizCategory = 'promosyon'; // VarsayÄ±lan olarak promosyon quizleri aktif

        // YardÄ±mcÄ± fonksiyon: Metin temizleme
        function cleanText(text) {
            if (typeof text !== 'string') return text;
            // NumaralandÄ±rma, Ã¶zel karakterler ve fazla boÅŸluklarÄ± temizle
            // CÃ¼mle sonundaki noktalama iÅŸaretlerini kaldÄ±r, ancak sayÄ±larÄ±n iÃ§indeki noktalara dokunma (Ã¶rn. 1.50)
            return text.replace(/^\d+\.\s*/, '') // BaÅŸÄ±ndaki '1. ' gibi numaralandÄ±rmayÄ± kaldÄ±r
                       .replace(/([.,;])\s*$/, '') // CÃ¼mle sonundaki noktalama iÅŸaretlerini kaldÄ±r
                       .replace(/\s+/g, ' ') // Birden fazla boÅŸluÄŸu tek boÅŸluÄŸa Ã§evir
                       .trim();
        }

        // YardÄ±mcÄ± fonksiyon: SayÄ±sal bir deÄŸerden rastgele yanlÄ±ÅŸ seÃ§enekler Ã¼retir
        function generateNumericWrongOptions(correctAnswer, count = 3) {
            const wrongOptions = new Set();
            let numAnswerString = correctAnswer.replace(/[^0-9.,]/g, ''); // Sadece sayÄ±sal karakterler, nokta ve virgÃ¼l kalÄ±r
            
            // EÄŸer binlik ayraÃ§ olarak nokta, ondalÄ±k ayraÃ§ olarak virgÃ¼l kullanÄ±lÄ±yorsa (Ã¶rn: 10.000.000,50 EUR)
            if (numAnswerString.includes('.') && numAnswerString.includes(',') && numAnswerString.indexOf('.') < numAnswerString.indexOf(',')) {
                numAnswerString = numAnswerString.replace(/\./g, '').replace(',', '.');
            } else if (numAnswerString.includes('.') && !numAnswerString.includes(',') && numAnswerString.lastIndexOf('.') !== numAnswerString.indexOf('.')) {
                // Birden fazla nokta varsa ve virgÃ¼l yoksa, noktalarÄ± binlik ayraÃ§ olarak kabul et (Ã¶rn: 1.000.000 TL)
                numAnswerString = numAnswerString.replace(/\./g, '');
            } else if (numAnswerString.includes(',') && !numAnswerString.includes('.')) {
                // Sadece virgÃ¼l varsa, virgÃ¼lÃ¼ ondalÄ±k ayraÃ§ olarak kabul et (Ã¶rn: 100,50 TL)
                numAnswerString = numAnswerString.replace(',', '.');
            }

            const numAnswer = parseFloat(numAnswerString); // SayÄ±sal deÄŸeri Ã§Ä±kar
            if (isNaN(numAnswer)) return [];

            while (wrongOptions.size < count) {
                let newOption;
                const variation = numAnswer * (0.1 + Math.random() * 0.4); // %10 ila %50 varyasyon
                const operation = Math.random() > 0.5 ? 1 : -1; // ArtÄ±rma veya azaltma
                newOption = (Math.round((numAnswer + operation * variation) * 100) / 100).toLocaleString('tr-TR', { minimumFractionDigits: numAnswerString.includes('.') && numAnswerString.split('.')[1] ? numAnswerString.split('.')[1].length : 0 }); // Ä°ki ondalÄ±k basamaÄŸa yuvarla ve yerel format

                // Orijinal birimini koru
                let unit = '';
                if (correctAnswer.includes('â‚º')) unit = 'â‚º';
                else if (correctAnswer.includes('%')) unit = '%';
                else if (correctAnswer.includes('EUR')) unit = ' EUR';
                else if (correctAnswer.includes('adet')) unit = ' adet';
                else if (correctAnswer.includes('gÃ¼n')) unit = ' gÃ¼n';
                else if (correctAnswer.includes('saat')) unit = ' saat';
                else if (correctAnswer.includes('hafta')) unit = ' hafta';
                else if (correctAnswer.includes('ay')) unit = ' ay';
                else if (correctAnswer.includes('yÄ±l')) unit = ' yÄ±l';
                
                newOption = `${newOption}${unit}`;

                if (cleanText(newOption.toString()) !== cleanText(correctAnswer) && !wrongOptions.has(cleanText(newOption.toString()))) {
                    wrongOptions.add(cleanText(newOption.toString()));
                }
            }
            return Array.from(wrongOptions);
        }

        // YardÄ±mcÄ± fonksiyon: Tarih veya sÃ¼re bilgisinden yanlÄ±ÅŸ seÃ§enekler Ã¼retir
        function generateTimeWrongOptions(correctAnswer, count = 3) {
            const wrongOptions = new Set();
            const phrases = ["24 saat", "48 saat", "72 saat", "1 gÃ¼n", "3 gÃ¼n", "5 gÃ¼n", "1 hafta", "1 ay", "6 ay", "1 yÄ±l", "BelirtilmemiÅŸ", "SÃ¼resiz", "Pazartesi", "SalÄ±", "Ã‡arÅŸamba", "PerÅŸembe", "Cuma", "Hafta sonlarÄ±", "Sadece resmi tatillerde"];

            while (wrongOptions.size < count) {
                const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
                if (cleanText(randomPhrase) !== cleanText(correctAnswer) && !wrongOptions.has(cleanText(randomPhrase))) {
                    wrongOptions.add(cleanText(randomPhrase));
                }
            }
            return Array.from(wrongOptions);
        }

        // YardÄ±mcÄ± fonksiyon: Genel metinlerden yanlÄ±ÅŸ seÃ§enekler Ã¼retir
        function generateGeneralWrongOptions(correctAnswer, specificCategoryAnswers, count = 3) {
            const wrongOptions = new Set();
            // Daha genel veya kafa karÄ±ÅŸtÄ±rÄ±cÄ± olabilecek seÃ§enekler
            const genericOptions = ["BelirtilmemiÅŸ", "DeÄŸiÅŸkendir", "Bilgi yok", "GeÃ§ersiz", "Her zaman geÃ§erli", "TÃ¼m oyunlarda", "HiÃ§biri", "FarklÄ± bir koÅŸula baÄŸlÄ±", "Ekstra bir ÅŸart yok", "CanlÄ± destekten Ã¶ÄŸrenilmeli", "Ã–zel bir kod ile", "Sadece yeni Ã¼yelere Ã¶zel", "Sadece spor", "Sadece casino", "CanlÄ± destek", "E-posta", "Ã‡evrim ÅŸartsÄ±z", "Sadece belli gÃ¼nler", "GeÃ§ersiz bonus kodu", "Her yatÄ±rÄ±m yÃ¶nteminde", "Sadece mobil Ã¶deme ile", "Sadece kredi kartÄ± ile", "TÃ¼m Ã¼yeler", "Sadece VIP Ã¼yeler", "Sadece belirli oyunlarda", "YÃ¼ksek Ã§evrim ÅŸartÄ±", "DÃ¼ÅŸÃ¼k Ã§evrim ÅŸartÄ±", "Bonus ve anaparanÄ±n 1 katÄ±", "Bonusun 3 katÄ±", "YatÄ±rÄ±mÄ±n 5 katÄ±", "24 saat iÃ§inde", "7 gÃ¼n iÃ§inde", "HaftalÄ±k", "AylÄ±k", "Belirli yatÄ±rÄ±m yÃ¶ntemleri", "TÃ¼m yatÄ±rÄ±m yÃ¶ntemleri", "Sadece spor bahisleri", "Sadece canlÄ± casino", "Sadece slot oyunlarÄ±"];

            const cleanedCorrectAnswer = cleanText(correctAnswer);

            // Kategoriye Ã¶zel cevaplardan yanlÄ±ÅŸ seÃ§enekleri oluÅŸtur
            const categorySpecificWrongOptions = new Set();
            specificCategoryAnswers.forEach(val => {
                const cleanedVal = cleanText(val);
                if (cleanedVal !== cleanedCorrectAnswer && !cleanedVal.match(/^\d+[.,]?\d*\s*[â‚º$â‚¬%]/i) && !cleanedVal.match(/\d+\s*(saat|gÃ¼n|hafta|ay|yÄ±l)/i) && !cleanedVal.match(/Pazartesi|SalÄ±|Ã‡arÅŸamba|PerÅŸembe|Cuma|Hafta sonlarÄ±|SÃ¼resiz|BelirtilmemiÅŸ/i)) {
                    categorySpecificWrongOptions.add(cleanedVal);
                }
            });
            
            // Pool oluÅŸtur: Kategoriye Ã¶zel yanlÄ±ÅŸ seÃ§enekler + genel seÃ§enekler
            let pool = Array.from(categorySpecificWrongOptions);
            genericOptions.forEach(opt => {
                const cleanedOpt = cleanText(opt);
                if (cleanedOpt !== cleanedCorrectAnswer && !pool.includes(cleanedOpt)) {
                    pool.push(cleanedOpt);
                }
            });

            pool.sort(() => Math.random() - 0.5); // KarÄ±ÅŸtÄ±r

            // Yeterli sayÄ±da yanlÄ±ÅŸ seÃ§enek seÃ§
            while (wrongOptions.size < count && pool.length > 0) {
                const option = pool.shift();
                if (option && option.length > 0) {
                    wrongOptions.add(option);
                }
            }
            return Array.from(wrongOptions);
        }

        // Dinamik quiz sorularÄ± oluÅŸturma fonksiyonu
        function generateQuizQuestions(promo) {
            const dynamicQuizzes = [];
            const existingQuestions = new Set(); // Bu promosyon iÃ§in eklenen sorularÄ± takip etmek iÃ§in

            // Ortak havuzlarÄ± Ã¶nceden oluÅŸtur
            const allPromos = [...regularPromos, ...providerPromos];

            const allMinInvestmentAmounts = new Set();
            const allMaxAmounts = new Set();
            const allDurations = new Set();
            const allWagerRequirements = new Set();
            const allEligibleItems = new Set();
            const allIneligibleItems = new Set();
            const allClaimConditions = new Set();
            const allKeywords = new Set();

            allPromos.forEach(p => {
                if (p.basicInfo) {
                    for (const key in p.basicInfo) {
                        if (Object.hasOwnProperty.call(p.basicInfo, key)) {
                            const value = cleanText(p.basicInfo[key]);
                            if (key.includes("Miktar") || key.includes("YatÄ±rÄ±m") || key.includes("KazanÃ§") || key.includes("Bahis") || key.includes("Freespin") || key.includes("Oran")) {
                                allMinInvestmentAmounts.add(value);
                                allMaxAmounts.add(value);
                            } else if (key.includes("Tarih") || key.includes("SÃ¼resi") || key.includes("GÃ¼nler")) {
                                allDurations.add(value);
                            } else if (key.includes("Ã‡evrim")) {
                                allWagerRequirements.add(value);
                            } else if (key.includes("GeÃ§erli Oyunlar") || key.includes("GeÃ§erli MÃ¼sabakalar") || key.includes("KullanÄ±m")) {
                                allEligibleItems.add(value);
                            }
                        }
                    }
                }
                if (p.sections) {
                    const sectionContents = Array.isArray(p.sections) ? p.sections.flatMap(s => s.content || []).filter(item => typeof item === 'string') : 
                                            Object.values(p.sections).flatMap(s => s.content || []).filter(item => typeof item === 'string');
                    sectionContents.forEach(item => {
                        const cleanedItem = cleanText(item);
                        let match;

                        // Minimum yatÄ±rÄ±m/bahis
                        match = cleanedItem.match(/(?:minimum|en az)\s*(\d+[.,]?\d*\s*[â‚º$â‚¬]|\d+\s*Freespin|\d+\s*TL|\d+\s*EUR|\d+\s*adet)\s*(?:tutarÄ±nda|yatÄ±rÄ±m|bahis|ile yatÄ±rÄ±m)/i);
                        if (match) allMinInvestmentAmounts.add(cleanText(match[1]));

                        // Maksimum kazanÃ§/bonus/freespin
                        match = cleanedItem.match(/maksimum\s*(\d+[.,]?\d*\s*[â‚º$â‚¬]|\d+\s*Freespin|\d+\s*adet)\s*(?:kazanÃ§|freebet|bonus miktarÄ±|freespin|Ã§evrim ardÄ±ndan ana bakiyeye aktarÄ±lacak tutar)/i);
                        if (match) allMaxAmounts.add(cleanText(match[1]));

                        // GeÃ§erlilik sÃ¼resi
                        match = cleanedItem.match(/(?:geÃ§erlilik sÃ¼resi|\d+\s*(saat|gÃ¼n|hafta|ay|yÄ±l)\s*iÃ§inde kullanÄ±lmalÄ±dÄ±r|\d+\s*(saat|gÃ¼n|hafta|ay|yÄ±l)\s*geÃ§erlidir|promosyon\s*(\d+)\s*hafta boyunca sÃ¼recek)/i);
                        if (match) allDurations.add(cleanText(match[0].toLowerCase().includes('geÃ§erlilik sÃ¼resi') ? cleanedItem.split(/geÃ§erlilik sÃ¼resi\s*[:-]?\s*/i)[1].split(/\.|,|olmaktadÄ±r/i)[0].trim() : match[0]));

                        // Ã‡evrim ÅŸartÄ±
                        match = cleanedItem.match(/(?:Ã§evrim ÅŸartÄ±|Ã§evrimini tamamlamanÄ±z iÃ§in|Ã§evrim oranÄ±|kazanÃ§ miktarÄ±nÄ±n\s*(\d+)\s*katÄ± kadar Ã§evrim yapÄ±lmalÄ±dÄ±r|Ã§evrim yapÄ±lmalÄ±dÄ±r)\s*[:-]?\s*([\d\w%\s.,â‚º]+)(?:\.|\n|$|gerekmektedir)/i);
                        if (match) allWagerRequirements.add(cleanText(match[1] || match[2]));

                        // GeÃ§erli oyunlar/alanlar/branÅŸlar
                        match = cleanedItem.match(/(?:geÃ§erli oyunlar|geÃ§erlidir|kullanÄ±labilir|alanÄ±nda geÃ§erli)\s*[:-]?\s*(.+?)(?:\.|\n|$|hariÃ§|dÄ±ÅŸÄ±nda|veya|ancak)/i);
                        if (match && !cleanedItem.toLowerCase().includes("geÃ§erli deÄŸil") && !cleanedItem.toLowerCase().includes("hariÃ§") && !cleanedItem.toLowerCase().includes("dÄ±ÅŸÄ±nda")) {
                            match[1].split(/,|ve|hariÃ§|dÄ±ÅŸÄ±nda|veya|ancak/i).map(g => cleanText(g)).filter(g => g.length > 0 && !g.toLowerCase().includes("belirtilmedikÃ§e") && !g.toLowerCase().includes("bazÄ± oyunlar Ã§evrime dahil deÄŸildir")).forEach(item => allEligibleItems.add(item));
                        }
                        
                        // Kimler yararlanamaz/dahil deÄŸildir
                        match = cleanedItem.match(/(?:yararlanamaz|faydalanamaz|dahil deÄŸildir|hariÃ§)\s*[:-]?\s*(.+?)(?:\.|\n|$)/i);
                        if (match) {
                            match[1].split(/,|ve/i).map(g => cleanText(g)).filter(g => g.length > 0).forEach(item => allIneligibleItems.add(item));
                        }

                        // Talep koÅŸullarÄ±
                        match = cleanedItem.match(/(?:talep edilmesi gerekmektedir|talep etmeniz gerekmektedir|talep edilmeli|yatÄ±rÄ±m yÃ¶ntemi ile yatÄ±rÄ±m yapmanÄ±z gerekmektedir|bonus seÃ§ kÄ±smÄ±na tÄ±klayarak.+?bonusu seÃ§ilerek yatÄ±rÄ±m yapmanÄ±z durumunda otomatik olarak bonus buy.+?hesabÄ±nÄ±za aktarÄ±lacaktÄ±r)\s*[:-]?\s*(.+?)(?:\.|\n|$)/i);
                        if (match) allClaimConditions.add(cleanText(match[1] || match[0]));
                    });
                }
                if (p.keywords) {
                    let keywordsArray = Array.isArray(p.keywords) ? p.keywords : p.keywords.split(',').map(k => k.trim());
                    keywordsArray.forEach(k => allKeywords.add(cleanText(k)));
                }
            });

            const uniqueAllMinInvestmentAmounts = Array.from(allMinInvestmentAmounts).filter(Boolean);
            const uniqueAllMaxAmounts = Array.from(allMaxAmounts).filter(Boolean);
            const uniqueAllDurations = Array.from(allDurations).filter(Boolean);
            const uniqueAllWagerRequirements = Array.from(allWagerRequirements).filter(Boolean);
            const uniqueAllEligibleItems = Array.from(allEligibleItems).filter(Boolean);
            const uniqueAllIneligibleItems = Array.from(allIneligibleItems).filter(Boolean);
            const uniqueAllClaimConditions = Array.from(allClaimConditions).filter(Boolean);
            const uniqueAllKeywords = Array.from(allKeywords).filter(Boolean);

            // 1. basicInfo'dan sorular oluÅŸturma
            if (promo.basicInfo) {
                for (const key in promo.basicInfo) {
                    if (Object.hasOwnProperty.call(promo.basicInfo, key)) {
                        const answer = cleanText(promo.basicInfo[key]);
                        if (answer && answer !== "Yok" && answer !== "SÃ¼resiz" && answer !== "Her zaman" && answer.length > 3) { // KÄ±sa ve anlamsÄ±z cevaplarÄ± ele
                            const question = `${promo.title} promosyonunda "${key}" nedir?`;
                            if (existingQuestions.has(cleanText(question))) continue; // Soru daha Ã¶nce eklendi mi kontrol et

                            let options = [answer]; // DoÄŸru cevap

                            if (key.includes("Miktar") || key.includes("YatÄ±rÄ±m") || key.includes("KazanÃ§") || key.includes("Bahis") || key.includes("Freespin") || key.includes("Oran")) {
                                options = options.concat(generateNumericWrongOptions(answer, 3));
                            } else if (key.includes("Tarih") || key.includes("SÃ¼resi") || key.includes("GÃ¼nler")) {
                                options = options.concat(generateTimeWrongOptions(answer, 3));
                            } else {
                                // Genel kategori iÃ§in, burada daha akÄ±llÄ± bir yanlÄ±ÅŸ seÃ§enek havuzu kullanÄ±lmalÄ±
                                // Åžimdilik tÃ¼m promosyonlardaki basicInfo deÄŸerlerini toplayalÄ±m
                                const allBasicInfoValues = allPromos.flatMap(p => p.basicInfo ? Object.values(p.basicInfo).map(cleanText) : []).filter(Boolean);
                                options = options.concat(generateGeneralWrongOptions(answer, allBasicInfoValues, 3));
                            }

                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(answer);

                            if (correctIndex !== -1 && options.length > 1) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `${promo.title} promosyonunda "${key}", ${answer} olarak belirtilmiÅŸtir.`
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                    }
                }
            }

            // 2. sections'tan sorular oluÅŸturma (daha derinlemesine)
            if (promo.sections) {
                const sectionContents = Array.isArray(promo.sections) ? promo.sections.flatMap(s => s.content || []).filter(item => typeof item === 'string') : 
                                        Object.values(promo.sections).flatMap(s => s.content || []).filter(item => typeof item === 'string');

                sectionContents.forEach(item => {
                    const cleanedItem = cleanText(item);

                    // Minimum yatÄ±rÄ±m miktarÄ± sorularÄ±
                    let match = cleanedItem.match(/(?:minimum|en az)\s*(\d+[.,]?\d*\s*[â‚º$â‚¬]|\d+\s*Freespin|\d+\s*TL|\d+\s*EUR|\d+\s*adet)\s*(?:tutarÄ±nda|yatÄ±rÄ±m|bahis|ile yatÄ±rÄ±m)/i);
                    if (match) {
                        const amount = cleanText(match[1]);
                        const question = `Bu promosyondan yararlanmak iÃ§in minimum yatÄ±rÄ±m/bahis miktarÄ± ne kadardÄ±r?`;
                        if (!existingQuestions.has(cleanText(question))) {
                            let options = [amount];
                            options = options.concat(generateNumericWrongOptions(amount, 3));
                            options = options.concat(uniqueAllMinInvestmentAmounts.filter(val => cleanText(val) !== cleanText(amount)).sort(() => Math.random() - 0.5).slice(0, 2));
                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(amount);
                            if (correctIndex !== -1 && options.length > 1) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `Minimum yatÄ±rÄ±m/bahis miktarÄ± ${amount} olarak belirtilmiÅŸtir.`
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                    }

                    // Maksimum kazanÃ§/bonus/freespin miktarÄ± sorularÄ±
                    match = cleanedItem.match(/maksimum\s*(\d+[.,]?\d*\s*[â‚º$â‚¬]|\d+\s*Freespin|\d+\s*adet)\s*(?:kazanÃ§|freebet|bonus miktarÄ±|freespin|Ã§evrim ardÄ±ndan ana bakiyeye aktarÄ±lacak tutar)/i);
                    if (match) {
                        const amount = cleanText(match[1]);
                        const type = (match[2] || '').toLowerCase().includes('freespin') ? 'freespin' : 'bonus/kazanÃ§';
                        const question = `Bu promosyonda alÄ±nabilecek maksimum ${type} miktarÄ± ne kadardÄ±r?`;
                        if (!existingQuestions.has(cleanText(question))) {
                            let options = [amount];
                            options = options.concat(generateNumericWrongOptions(amount, 3));
                            options = options.concat(uniqueAllMaxAmounts.filter(val => cleanText(val) !== cleanText(amount)).sort(() => Math.random() - 0.5).slice(0, 2));
                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(amount);
                            if (correctIndex !== -1 && options.length > 1) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `Maksimum ${type} miktarÄ± ${amount} olarak belirtilmiÅŸtir.`
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                    }

                    // GeÃ§erlilik sÃ¼resi sorularÄ±
                    match = cleanedItem.match(/(?:geÃ§erlilik sÃ¼resi|\d+\s*(saat|gÃ¼n|hafta|ay|yÄ±l)\s*iÃ§inde kullanÄ±lmalÄ±dÄ±r|\d+\s*(saat|gÃ¼n|hafta|ay|yÄ±l)\s*geÃ§erlidir|promosyon\s*(\d+)\s*hafta boyunca sÃ¼recek)/i);
                    if (match) {
                        let duration = cleanText(match[0].toLowerCase().includes('geÃ§erlilik sÃ¼resi') ? cleanedItem.split(/geÃ§erlilik sÃ¼resi\s*[:-]?\s*/i)[1].split(/\.|,|olmaktadÄ±r/i)[0].trim() : match[0]);
                        if (match[2]) duration = cleanText(match[2] + ' hafta'); // "30 hafta boyunca sÃ¼recek" gibi ifadeler iÃ§in

                        if (duration && duration !== "SÃ¼resiz" && duration !== "BelirtilmemiÅŸ" && duration.length > 3) {
                            const question = `Bu promosyonun geÃ§erlilik sÃ¼resi ne kadardÄ±r?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [duration];
                                options = options.concat(generateTimeWrongOptions(duration, 3));
                                options = options.concat(uniqueAllDurations.filter(val => cleanText(val) !== cleanText(duration)).sort(() => Math.random() - 0.5).slice(0, 2));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(duration);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Promosyonun geÃ§erlilik sÃ¼resi ${duration} olarak belirtilmiÅŸtir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }
                    
                    // Ã‡evrim ÅŸartÄ± sorularÄ±
                    match = cleanedItem.match(/(?:Ã§evrim ÅŸartÄ±|Ã§evrimini tamamlamanÄ±z iÃ§in|Ã§evrim oranÄ±|kazanÃ§ miktarÄ±nÄ±n\s*(\d+)\s*katÄ± kadar Ã§evrim yapÄ±lmalÄ±dÄ±r|Ã§evrim yapÄ±lmalÄ±dÄ±r)\s*[:-]?\s*([\d\w%\s.,â‚º]+)(?:\.|\n|$|gerekmektedir)/i);
                    if (match) {
                        const wager = cleanText(match[1] || match[2]); // Regex gruplarÄ±nÄ± kontrol et
                        if (wager && wager !== "Yok" && wager !== "BulunmamaktadÄ±r" && wager !== "Dahil deÄŸildir" && wager.length > 3) {
                            const question = `Bu promosyonun Ã§evrim ÅŸartÄ± nedir?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [wager];
                                // Sadece aynÄ± kategoriden (Ã§evrim ÅŸartlarÄ±) yanlÄ±ÅŸ ÅŸÄ±klar Ã¼ret
                                options = options.concat(generateGeneralWrongOptions(wager, uniqueAllWagerRequirements, 3));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(wager);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Ã‡evrim ÅŸartÄ± ${wager} olarak belirtilmiÅŸtir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }

                    // GeÃ§erli oyunlar/alanlar/branÅŸlar sorularÄ±
                    match = cleanedItem.match(/(?:geÃ§erli oyunlar|geÃ§erlidir|kullanÄ±labilir|alanÄ±nda geÃ§erli)\s*[:-]?\s*(.+?)(?:\.|\n|$|hariÃ§|dÄ±ÅŸÄ±nda|veya|ancak)/i);
                    if (match && !cleanedItem.toLowerCase().includes("geÃ§erli deÄŸil") && !cleanedItem.toLowerCase().includes("hariÃ§") && !cleanedItem.toLowerCase().includes("dÄ±ÅŸÄ±nda")) { 
                        const games = match[1].split(/,|ve|hariÃ§|dÄ±ÅŸÄ±nda|veya|ancak/i).map(g => cleanText(g)).filter(g => g.length > 0 && !g.toLowerCase().includes("belirtilmedikÃ§e") && !g.toLowerCase().includes("bazÄ± oyunlar Ã§evrime dahil deÄŸildir"));
                        if (games.length > 0) {
                            const correctAnswer = games[0]; 
                            const question = `Bu promosyonda geÃ§erli olan oyun/alan/branÅŸlardan biri hangisidir?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [correctAnswer];
                                options = options.concat(generateGeneralWrongOptions(correctAnswer, uniqueAllEligibleItems, 3));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(correctAnswer);
    if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `GeÃ§erli oyun/alan/branÅŸlardan biri ${correctAnswer} olarak belirtilmiÅŸtir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }

                    // Kimler yararlanamaz/dahil deÄŸildir sorularÄ± (Negatif soru tipi)
                    match = cleanedItem.match(/(?:yararlanamaz|faydalanamaz|dahil deÄŸildir|hariÃ§)\s*[:-]?\s*(.+?)(?:\.|\n|$)/i);
                    if (match) {
                        const cannotBenefit = match[1].split(/,|ve/i).map(g => cleanText(g)).filter(g => g.length > 0);
                        if (cannotBenefit.length > 0) {
                            const correctAnswer = cannotBenefit[0];
                            const question = `AÅŸaÄŸÄ±dakilerden hangisi bu promosyondan yararlanamaz / Ã§evrime dahil deÄŸildir?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [correctAnswer];
                                options = options.concat(generateGeneralWrongOptions(correctAnswer, uniqueAllIneligibleItems, 3));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(correctAnswer);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `${correctAnswer} bu promosyondan yararlanamaz / Ã§evrime dahil deÄŸildir olarak belirtilmiÅŸtir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }

                    // Talep edilmesi gereken durumlar/Ã¶deme yÃ¶ntemleri
                    match = cleanedItem.match(/(?:talep edilmesi gerekmektedir|talep etmeniz gerekmektedir|talep edilmeli|yatÄ±rÄ±m yÃ¶ntemi ile yatÄ±rÄ±m yapmanÄ±z gerekmektedir|bonus seÃ§ kÄ±smÄ±na tÄ±klayarak.+?bonusu seÃ§ilerek yatÄ±rÄ±m yapmanÄ±z durumunda otomatik olarak bonus buy.+?hesabÄ±nÄ±za aktarÄ±lacaktÄ±r)\s*[:-]?\s*(.+?)(?:\.|\n|$)/i);
                    if (match) {
                        const claimCondition = cleanText(match[1] || match[0]); // match[0] tÃ¼m eÅŸleÅŸen ifadeyi iÃ§erir
                        if (claimCondition && claimCondition.length > 5) { // KÄ±sa ifadeleri filtrele
                            const question = `Bu promosyonu talep etmek iÃ§in ne gereklidir veya hangi yatÄ±rÄ±m yÃ¶ntemi kullanÄ±lmalÄ±dÄ±r?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [claimCondition];
                                options = options.concat(generateGeneralWrongOptions(claimCondition, uniqueAllClaimConditions, 3));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(claimCondition);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Promosyonun talep edilmesi iÃ§in: ${claimCondition}`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }

                    // Bonus durdurma/iptal etme hakkÄ± (daha spesifik)
                    if (cleanedItem.match(/(?:Hproject|Hitbet)\s*dilediÄŸi zaman bu bonusu durdurma ya da iptal etme hakkÄ±na sahiptir/i)) {
                        const question = "Hproject, promosyonu dilediÄŸi zaman durdurma veya iptal etme hakkÄ±na sahip midir?";
                        if (!existingQuestions.has(cleanText(question))) {
                            dynamicQuizzes.push({
                                question: question,
                                options: ["Evet", "HayÄ±r", "Sadece Ã¼yelerin onayÄ±yla", "Sadece belirli koÅŸullarda"],
                                correct: 0,
                                explanation: "Evet, Hproject promosyonu dilediÄŸi zaman durdurma veya iptal etme hakkÄ±na sahiptir."
                            });
                            existingQuestions.add(cleanText(question));
                        }
                    }
                    
                    // KÃ¶tÃ¼ye kullanÄ±m ÅŸartÄ±
                    if (cleanedItem.match(/(?:Bonus|kazanÃ§)(?:Ä±nÄ±)?\s*kÃ¶tÃ¼ye kullanma durumunda\s*(?:Hproject|Hitbet)\s*(?:bonusu ve kazancÄ± geri alma hakkÄ±na sahiptir|bonus ve kazanÃ§ geri alÄ±nÄ±r)/i)) {
                        const question = "Bonusun kÃ¶tÃ¼ye kullanÄ±lmasÄ± durumunda ne olur?";
                        if (!existingQuestions.has(cleanText(question))) {
                            dynamicQuizzes.push({
                                question: question,
                                options: ["Bonus ve kazanÃ§ geri alÄ±nÄ±r", "Sadece bonus iptal edilir", "ÃœyeliÄŸe geÃ§ici el konulur", "Herhangi bir iÅŸlem yapÄ±lmaz"],
                                correct: 0,
                                explanation: "Bonus veya kazancÄ±nÄ± kÃ¶tÃ¼ye kullanma durumunda Hproject bonus ve kazancÄ± geri alma hakkÄ±na sahiptir."
                            });
                            existingQuestions.add(cleanText(question));
                        }
                    }

                    // Cash Out Ã¶zel sorularÄ± (mevcut sorularÄ± koru ve geliÅŸtir)
                    if (promo.id === 'cash-out') {
                        // Cash Out hangi bahis tÃ¼rlerinde geÃ§erlidir?
                        if (cleanedItem.includes("Cash Out sadece spor bahislerinde geÃ§erlidir")) {
                            const question = "Cash Out hangi bahis tÃ¼rlerinde geÃ§erlidir?";
                            if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: [
                                        "Casino oyunlarÄ±nda",
                                        "Sadece canlÄ± bahislerde",
                                        "Spor bahislerinde",
                                        "Slot oyunlarÄ±nda"
                                    ],
                                    correct: 2,
                                    explanation: "Cash Out sadece spor bahislerinde geÃ§erlidir."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                        // Cash Out kullanmak iÃ§in hangi bahis tÃ¼rÃ¼nde kuponunuz olmalÄ±dÄ±r?
                        if (cleanedItem.includes("spor bahsinizin olmasÄ± gerekmektedir")) {
                            const question = "Cash Out kullanmak iÃ§in hangi bahis tÃ¼rÃ¼nde kuponunuz olmalÄ±dÄ±r?";
                            if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: ["Spor bahsi", "Casino oyunu", "CanlÄ± casino", "Sanal bahis"],
                                    correct: 0,
                                    explanation: "Cash Out Ã¶zelliÄŸinden yararlanabilmek iÃ§in bir spor bahsinizin olmasÄ± gerekmektedir."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                        // Cash Out'tan yararlanmak iÃ§in bahis aldÄ±ÄŸÄ±nÄ±z market tercihinin hangi durumda olmasÄ± gerekir?
                        if (cleanedItem.includes("canlÄ± bahislerde aktif olmasÄ± gerekmektedir")) {
                             const question = "Cash Out'tan yararlanmak iÃ§in bahis aldÄ±ÄŸÄ±nÄ±z market tercihinin hangi durumda olmasÄ± gerekir?";
                             if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: ["CanlÄ± bahislerde aktif olmasÄ±", "MaÃ§ Ã¶ncesi bahislerde aktif olmasÄ±", "TÃ¼m bahislerde aktif olmasÄ±", "Herhangi bir aktiflik gerekmez"],
                                    correct: 0,
                                    explanation: "Cash Out Ã¶zelliÄŸinden yararlanabilmeniz iÃ§in bahis aldÄ±ÄŸÄ±nÄ±z market tercihinin canlÄ± bahislerde aktif olmasÄ± gerekmektedir."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                        // Hangi durumda Cash Out aktif olmayabilir?
                        if (cleanedItem.includes("cash out seÃ§eneÄŸi aktif olmayacaktÄ±r.") && cleanedItem.includes("oranÄ± aktif deÄŸil ise")) {
                            const question = "Hangi durumda Cash Out aktif olmayabilir?";
                            if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: ["Bahis oynadÄ±ÄŸÄ±nÄ±z marketin oranÄ± aktif deÄŸilse", "MaÃ§ sonucu berabere ise", "MaÃ§ henÃ¼z baÅŸlamamÄ±ÅŸsa", "YatÄ±rÄ±m miktarÄ±nÄ±z az ise"],
                                    correct: 0,
                                    explanation: "Bahis oynadÄ±ÄŸÄ±nÄ±z market tercihinin canlÄ± bahislerde aktif olmamasÄ± durumunda cash out seÃ§eneÄŸi aktif olmayacaktÄ±r."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                        // Cash Out seÃ§eneÄŸi hakkÄ±nda doÄŸru ifade hangisidir?
                        if (cleanedItem.includes("hemen hemen her karÅŸÄ±laÅŸmada mevcuttur")) {
                            const question = "Cash Out seÃ§eneÄŸi hakkÄ±nda doÄŸru ifade hangisidir?";
                            if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: ["Hemen hemen her karÅŸÄ±laÅŸmada mevcuttur", "Sadece bÃ¼yÃ¼k liglerde mevcuttur", "Sadece tekli bahislerde mevcuttur", "HiÃ§bir karÅŸÄ±laÅŸmada mevcut deÄŸildir"],
                                    correct: 0,
                                    explanation: "Cash Out seÃ§eneÄŸi hemen hemen her karÅŸÄ±laÅŸmada mevcuttur."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                        // KarÅŸÄ±laÅŸmanÄ±n ertelenmesi Cash Out Ã¶zelliÄŸini nasÄ±l etkiler?
                        if (cleanedItem.includes("karÅŸÄ±laÅŸmanÄ±n ertelenmesi durumunda bahis-bozdur Ã¶zelliÄŸini kaybeder")) {
                            const question = "KarÅŸÄ±laÅŸmanÄ±n ertelenmesi Cash Out Ã¶zelliÄŸini nasÄ±l etkiler?";
                            if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: ["Ã–zelliÄŸi kaybeder", "Daha yÃ¼ksek oran sunar", "Otomatik olarak bozulur", "DeÄŸiÅŸmeden kalÄ±r"],
                                    correct: 0,
                                    explanation: "Bahis bozdur Ã¶zelliÄŸi bulunan bahisler, karÅŸÄ±laÅŸmanÄ±n ertelenmesi durumunda bahis-bozdur Ã¶zelliÄŸini kaybeder."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                        // Cash Out bahisleri Ã§evrim ÅŸartÄ±na dahil midir?
                        if (cleanedItem.includes("Cash Out bahisler Ã§evrime dahil deÄŸildir")) {
                             const question = "Cash Out bahisleri Ã§evrim ÅŸartÄ±na dahil midir?";
                             if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: ["HayÄ±r, dahil deÄŸildir", "Evet, tamamen dahildir", "KÄ±smen dahildir", "Sadece belirli durumlarda dahildir"],
                                    correct: 0,
                                    explanation: "Cash Out bahisler Ã§evrime dahil deÄŸildir."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                    }

                    // Kalamba Ã¶zel sorularÄ±
                    if (promo.id === 'kalamba-cash-drop') {
                        // Minimum bahis tutarÄ±
                        match = cleanedItem.match(/en az\s*(\d+)\s*TL tutarÄ±nda bahis almanÄ±z gerekmektedir/i);
                        if (match) {
                            const amount = cleanText(match[1] + " TL");
                            const question = `Kalamba Cash Drop turnuvasÄ±nda Ã¶dÃ¼lden faydalanabilmek iÃ§in en az ne kadar bahis almanÄ±z gerekmektedir?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [amount];
                                options = options.concat(generateNumericWrongOptions(amount, 3));
                                options = options.concat(uniqueAllMinInvestmentAmounts.filter(val => cleanText(val) !== cleanText(amount)).sort(() => Math.random() - 0.5).slice(0, 2));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(amount);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Kalamba Cash Drop turnuvasÄ±nda Ã¶dÃ¼lden faydalanabilmek iÃ§in en az ${amount} tutarÄ±nda bahis almanÄ±z gerekmektedir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                        // Turnuva sÃ¼resi
                        match = cleanedItem.match(/promosyon\s*(\d+)\s*hafta boyunca sÃ¼recek/i);
                        if (match) {
                            const duration = cleanText(match[1] + " hafta");
                            const question = `Kalamba Cash Drop promosyonu kaÃ§ hafta boyunca sÃ¼recektir?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [duration];
                                options = options.concat(generateTimeWrongOptions(duration, 3));
                                options = options.concat(uniqueAllDurations.filter(val => cleanText(val) !== cleanText(duration)).sort(() => Math.random() - 0.5).slice(0, 2));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(duration);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Kalamba Cash Drop promosyonu ${duration} boyunca sÃ¼recektir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                        // Ã–dÃ¼l daÄŸÄ±tÄ±mÄ±
                        match = cleanedItem.match(/Ã¶dÃ¼ller\s*bahis deÄŸerlerine gÃ¶re tamamen random olarak daÄŸÄ±tÄ±lmaktadÄ±r/i);
                        if (match) {
                            const answer = cleanText("Bahis deÄŸerlerine gÃ¶re tamamen random olarak");
                            const question = `Kalamba Cash Drop turnuvasÄ±nda Ã¶dÃ¼ller nasÄ±l daÄŸÄ±tÄ±lmaktadÄ±r?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [answer];
                                options = options.concat(generateGeneralWrongOptions(answer, uniqueAllEligibleItems, 3)); // Burada daha genel bir havuz kullanmak mantÄ±klÄ± olabilir
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(answer);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Kalamba Cash Drop turnuvasÄ±nda Ã¶dÃ¼ller ${answer} daÄŸÄ±tÄ±lmaktadÄ±r.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }
                });
            }

            // Genel Bonus KurallarÄ± ile ilgili ek sorular (tÃ¼m promosyonlara uygulanabilir)
            const generalRulesQuestions = [
                {
                    question: "Hproject genel bonus kurallarÄ± bu promosyonda geÃ§erli midir?",
                    options: ["Evet", "HayÄ±r", "KÄ±smen", "Sadece belirli durumlarda"],
                    correct: 0,
                    explanation: "Evet, Hproject genel bonus kurallarÄ± bu promosyonda geÃ§erlidir."
                },
                {
                    question: "Hproject, promosyonu dilediÄŸi zaman durdurma veya iptal etme hakkÄ±na sahip midir?",
                    options: ["Evet", "HayÄ±r", "Sadece Ã¼yelerin onayÄ±yla", "Sadece belirli koÅŸullarda"],
                    correct: 0,
                    explanation: "Evet, Hproject promosyonu dilediÄŸi zaman durdurma veya iptal etme hakkÄ±na sahiptir."
                },
                {
                    question: "Bonusun kÃ¶tÃ¼ye kullanÄ±lmasÄ± durumunda ne olur?",
                    options: ["Bonus ve kazanÃ§ geri alÄ±nÄ±r", "Sadece bonus iptal edilir", "ÃœyeliÄŸe geÃ§ici el konulur", "Herhangi bir iÅŸlem yapÄ±lmaz"],
                    correct: 0,
                    explanation: "Bonus veya kazancÄ±nÄ± kÃ¶tÃ¼ye kullanma durumunda Hproject bonus ve kazancÄ± geri alma hakkÄ±na sahiptir."
                }
            ];

            generalRulesQuestions.forEach(q => {
                if (!existingQuestions.has(cleanText(q.question))) {
                    dynamicQuizzes.push(q);
                    existingQuestions.add(cleanText(q.question));
                }
            });

            // Promosyonun kendisiyle ilgili genel sorular ekle (eÄŸer yeterli soru yoksa)
            if (dynamicQuizzes.length < 30) {
                // KÄ±sa aÃ§Ä±klama sorusu
                if (promo.shortDesc && promo.shortDesc !== "Yok" && promo.shortDesc.length > 3 && !existingQuestions.has(cleanText(`${promo.title} promosyonunun kÄ±sa aÃ§Ä±klamasÄ± nedir?`))) {
                    const question = `${promo.title} promosyonunun kÄ±sa aÃ§Ä±klamasÄ± nedir?`;
                    const answer = cleanText(promo.shortDesc);
                    let options = [answer];
                    // Genel kategori iÃ§in, burada daha akÄ±llÄ± bir yanlÄ±ÅŸ seÃ§enek havuzu kullanÄ±lmalÄ±
                    const allShortDescriptions = allPromos.map(p => cleanText(p.shortDesc)).filter(Boolean);
                    options = options.concat(generateGeneralWrongOptions(answer, allShortDescriptions, 3));
                    options = options.sort(() => Math.random() - 0.5);
                    const correctIndex = options.indexOf(answer);
                    if (correctIndex !== -1 && options.length > 1) {
                        dynamicQuizzes.push({
                            question: question,
                            options: options,
                            correct: correctIndex,
                            explanation: `${promo.title} promosyonunun kÄ±sa aÃ§Ä±klamasÄ±: ${answer}`
                        });
                        existingQuestions.add(cleanText(question));
                    }
                }

                // Anahtar kelime sorusu
                let keywordsArray = [];
                if (Array.isArray(promo.keywords)) {
                    keywordsArray = promo.keywords.map(cleanText);
                } else if (typeof promo.keywords === 'string') {
                    keywordsArray = promo.keywords.split(',').map(k => cleanText(k.trim())).filter(Boolean);
                }
                
                if (keywordsArray.length > 0 && !existingQuestions.has(cleanText(`${promo.title} promosyonunun anahtar kelimelerinden biri nedir?`))) {
                    const question = `${promo.title} promosyonunun anahtar kelimelerinden biri nedir?`;
                    const answer = keywordsArray[0];
                    let options = [answer];
                    options = options.concat(generateGeneralWrongOptions(answer, uniqueAllKeywords, 3));
                    options = options.sort(() => Math.random() - 0.5);
                    const correctIndex = options.indexOf(answer);
                    if (correctIndex !== -1 && options.length > 1) {
                        dynamicQuizzes.push({
                            question: question,
                            options: options,
                            correct: correctIndex,
                            explanation: `${promo.title} promosyonunun anahtar kelimelerinden biri: ${answer}`
                        });
                        existingQuestions.add(cleanText(question));
                    }
                }
            }

            // Son olarak, quiz sayÄ±sÄ±nÄ± hedeflemek iÃ§in yeterli soru yoksa, kalan boÅŸluklarÄ± doldurmak iÃ§in genel basicInfo sorularÄ±nÄ± tekrar dene
            if (dynamicQuizzes.length < 30) {
                if (promo.basicInfo) {
                    for (const key in promo.basicInfo) {
                        if (Object.hasOwnProperty.call(promo.basicInfo, key)) {
                            const answer = cleanText(promo.basicInfo[key]);
                            if (answer && answer !== "Yok" && answer !== "SÃ¼resiz" && answer !== "Her zaman" && answer.length > 3) {
                                const question = `${promo.title} promosyonunda "${key}" nedir?`;
                                if (!existingQuestions.has(cleanText(question))) {
                                    let options = [answer];
                                    // Burada da kategoriye Ã¶zel havuz kullanÄ±lmalÄ±
                                    if (key.includes("Miktar") || key.includes("YatÄ±rÄ±m") || key.includes("KazanÃ§") || key.includes("Bahis") || key.includes("Freespin") || key.includes("Oran")) {
                                        options = options.concat(generateNumericWrongOptions(answer, 3));
                                        options = options.concat(uniqueAllMinInvestmentAmounts.filter(val => cleanText(val) !== cleanText(answer)).sort(() => Math.random() - 0.5).slice(0, 2));
                                    } else if (key.includes("Tarih") || key.includes("SÃ¼resi") || key.includes("GÃ¼nler")) {
                                        options = options.concat(generateTimeWrongOptions(answer, 3));
                                        options = options.concat(uniqueAllDurations.filter(val => cleanText(val) !== cleanText(answer)).sort(() => Math.random() - 0.5).slice(0, 2));
                                    } else {
                                        const allBasicInfoValues = allPromos.flatMap(p => p.basicInfo ? Object.values(p.basicInfo).map(cleanText) : []).filter(Boolean);
                                        options = options.concat(generateGeneralWrongOptions(answer, allBasicInfoValues, 3));
                                    }
                                    options = options.sort(() => Math.random() - 0.5);
                                    const correctIndex = options.indexOf(answer);
                                    if (correctIndex !== -1 && options.length > 1) {
                                        dynamicQuizzes.push({
                                            question: question,
                                            options: options,
                                            correct: correctIndex,
                                            explanation: `${promo.title} promosyonunda "${key}", ${answer} olarak belirtilmiÅŸtir.`
                                        });
                                        existingQuestions.add(cleanText(question));
                                    }
                                }
                            }
                        }
                    }
                }
            }
            return dynamicQuizzes;
        }

        let askedQuizIndices = {}; // Her promosyon iÃ§in sorulan quiz indekslerini tutacak

        async function loadPromosData() {
            try {
                const promoFiles = [
                    'ertesi-gun.json',
                    'bonus-buy.json',
                    'hos-geldin.json',
                    'spor-freebet.json',
                    'casino-kayip-bonusu.json',
                    'freespin-600.json',
                    'cash-out.json',
                    'futbol-2-gol-onde-kazan.json',
                    'basketbol-20-sayi-onde-kazan.json',
                    'yeni-uyelere-deneme-bonusu.json',
                    'spor-kayip-bonusu.json',
                    'spor-hos-geldin-bonusu.json',
                    'blackjack-21-bonus.json'
                ];

                const providerPromoFiles = [
                    'pragmatic-play.json',
                    'kalamba-cash-drop.json',
                    'evoplay-big-adventures.json'
                ];

                regularPromos = [];
                providerPromos = [];

                // Normal promosyonlarÄ± yÃ¼kle
                for (const file of promoFiles) {
                    try {
                        const promoResponse = await fetch(`../promosyonlar/${file}`);
                        if (promoResponse.ok) {
                            const promo = await promoResponse.json();
                            if (promo.id !== 'pragmatic-play' && promo.id !== 'kalamba-cash-drop' && promo.id !== 'evoplay-big-adventures') { // SaÄŸlayÄ±cÄ± promosyonlarÄ±nÄ± burada yÃ¼klemeyi engelle
                                regularPromos.push(promo);
                            }
                        }
                    } catch (error) {
                        console.error(`Error loading regular promo ${file}:`, error);
                    }
                }

                // SaÄŸlayÄ±cÄ± promosyonlarÄ±nÄ± yÃ¼kle
                for (const file of providerPromoFiles) {
                    try {
                        const promoResponse = await fetch(`../promosyonlar/${file}`);
                        if (promoResponse.ok) {
                            const promo = await promoResponse.json();
                            providerPromos.push(promo);
                        }
                    } catch (error) {
                        console.error(`Error loading provider promo ${file}:`, error);
                    }
                }

                // BaÅŸlangÄ±Ã§ta aktif promosyonlarÄ± ayarla ve select box'Ä± gÃ¼ncelle
                showQuizCategory(currentQuizCategory);
            } catch (error) {
                console.error('Error loading all promos data:', error);
            }
        }

        function updatePromoSelect() {
            const select = document.getElementById('promo-select');
            select.innerHTML = '<option value="">Promosyon seÃ§in...</option>';
            
            activePromos.forEach(promo => {
                // Hem manuel hem de dinamik olarak oluÅŸturulan quizlerin varlÄ±ÄŸÄ±nÄ± kontrol et
                const hasManualQuizzes = promo.quiz && (Array.isArray(promo.quiz) && promo.quiz.length > 0 || typeof promo.quiz === 'object' && Object.keys(promo.quiz).length > 0);
                const dynamicQuizzes = generateQuizQuestions(promo);
                const hasDynamicQuizzes = dynamicQuizzes.length > 0;

                if (hasManualQuizzes || hasDynamicQuizzes) {
                    const option = document.createElement('option');
                    option.value = promo.id;
                    option.textContent = promo.title;
                    select.appendChild(option);
                }
            });
        }

        function showQuizCategory(category) {
            currentQuizCategory = category;

            // Tab butonlarÄ±nÄ±n stilini gÃ¼ncelle
            document.querySelectorAll('.quiz-category-tab').forEach(tab => {
                tab.style.background = '#1a3a6b';
                tab.style.color = '#ffffff';
                tab.classList.remove('active');
            });

            const activeTab = document.getElementById(`tab-${category}`);
            activeTab.style.background = '#ffc107';
            activeTab.style.color = '#0a1f44';
            activeTab.classList.add('active');

            // Aktif promosyon listesini ayarla
            if (category === 'promosyon') {
                activePromos = regularPromos;
            } else if (category === 'saglayici') {
                activePromos = providerPromos;
            }

            // Promosyon seÃ§imini ve quiz iÃ§eriÄŸini sÄ±fÄ±rla
            document.getElementById('promo-select').value = '';
            document.getElementById('quiz-content').style.display = 'none';
            document.getElementById('score-display').style.display = 'none';

            updatePromoSelect(); // Yeni listeye gÃ¶re seÃ§im kutusunu gÃ¼ncelle
        }

        function loadQuiz() {
            const selectedPromo = document.getElementById('promo-select').value;
            if (!selectedPromo) {
                document.getElementById('quiz-content').style.display = 'none';
                return;
            }

            const promo = activePromos.find(p => p.id === selectedPromo);
            if (!promo) {
                document.getElementById('quiz-content').style.display = 'none';
                alert('Bu promosyon iÃ§in quiz bulunamadÄ±!');
                return;
            }
            
            let allQuizzes = [];

            // Mevcut (manuel olarak eklenmiÅŸ) quizleri ekle
            if (promo.quiz) {
                allQuizzes = allQuizzes.concat(Array.isArray(promo.quiz) ? promo.quiz : [promo.quiz]);
            }
            
            // Dinamik olarak oluÅŸturulan quizleri ekle
            const dynamicQuizzes = generateQuizQuestions(promo);
            allQuizzes = allQuizzes.concat(dynamicQuizzes);

            if (allQuizzes.length === 0) {
                document.getElementById('quiz-content').style.display = 'none';
                alert('Bu promosyon iÃ§in quiz bulunamadÄ±!');
                return;
            }

            // Bu promosyon iÃ§in daha Ã¶nce sorulan quiz indekslerini al
            if (!askedQuizIndices[selectedPromo]) {
                askedQuizIndices[selectedPromo] = [];
            }

            let availableQuizIndices = Array.from({ length: allQuizzes.length }, (_, i) => i);
            availableQuizIndices = availableQuizIndices.filter(index => !askedQuizIndices[selectedPromo].includes(index));

            if (availableQuizIndices.length === 0) {
                alert('Bu promosyon iÃ§in tÃ¼m sorularÄ± yanÄ±tladÄ±nÄ±z! Sorular tekrar edecektir.');
                askedQuizIndices[selectedPromo] = []; // Sorular bittiÄŸinde listeyi sÄ±fÄ±rla
                availableQuizIndices = Array.from({ length: allQuizzes.length }, (_, i) => i); // TÃ¼m sorularÄ± tekrar kullanÄ±labilir yap
            }

            const randomAvailableIndex = Math.floor(Math.random() * availableQuizIndices.length);
            const selectedQuizIndex = availableQuizIndices[randomAvailableIndex];

            currentQuiz = allQuizzes[selectedQuizIndex];
            askedQuizIndices[selectedPromo].push(selectedQuizIndex); // Sorulan soruyu iÅŸaretle
            
            document.getElementById('quiz-content').style.display = 'block';
            
            document.getElementById('quiz-question').textContent = currentQuiz.question;
            
            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';
            
            currentQuiz.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'quiz-option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(optionDiv, index);
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('score-display').style.display = 'none';
            document.getElementById('check-btn').disabled = false;
            currentAnswer = -1;
        }

        function selectOption(element, answerIndex) {
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.classList.remove('selected');
                option.classList.remove('correct');
                option.classList.remove('incorrect');
            });
            
            element.classList.add('selected');
            currentAnswer = answerIndex;
        }

        function checkAnswer() {
            if (currentAnswer === -1) {
                alert('LÃ¼tfen bir seÃ§enek seÃ§in!');
                return;
            }

            if (!currentQuiz) return;

            const options = document.querySelectorAll('.quiz-option');
            
            options[currentQuiz.correct].classList.add('correct');
            
            if (currentAnswer !== currentQuiz.correct) {
                options[currentAnswer].classList.add('incorrect');
            }

            document.getElementById('check-btn').disabled = true;
            
            const scoreDisplay = document.getElementById('score-display');
            const scoreText = document.getElementById('score-text');
            
            if (currentAnswer === currentQuiz.correct) {
                scoreText.innerHTML = `ðŸŽ‰ Tebrikler! DoÄŸru cevap!<br><small>${currentQuiz.explanation}</small>`;
                scoreText.style.color = '#28a745';
            } else {
                scoreText.innerHTML = `âŒ YanlÄ±ÅŸ cevap. DoÄŸru cevap: ${currentQuiz.options[currentQuiz.correct]}<br><small>${currentQuiz.explanation}</small>`;
                scoreText.style.color = '#dc3545';
            }
            
            scoreDisplay.style.display = 'block';
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadPromosData();
        });
    </script>
</body>
</html>
