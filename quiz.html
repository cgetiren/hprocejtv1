<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promosyon Quizleri</title>
    <style>
        /* index.html dosyasÄ±ndaki ilgili CSS stillerini buraya kopyalayacaÄŸÄ±z */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a1f44;
            color: #ffffff;
            padding: 20px;
        }

        .quiz-container {
            background: #142d5f;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .quiz-question {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #ffc107; /* SarÄ± */
        }

        .quiz-options {
            display: grid;
            gap: 10px;
        }

        .quiz-option {
            background: #0a1f44;
            border: 2px solid #1a3a6b;
            color: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            border-color: #ffc107;
            background: #1a3a6b;
        }

        .quiz-option.selected {
            border-color: #ffc107;
            background: #ffc107;
            color: #0a1f44;
        }

        .quiz-option.correct {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }

        .quiz-option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }

        .quiz-button {
            background: #ffc107;
            color: #0a1f44;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .quiz-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            background: #ffeb3b;
        }

        .quiz-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .score-display {
            background: #1a3a6b;
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #ffffff;
        }

        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
            background-color: #0a1f44; /* Koyu lacivert */
            color: #ffffff; /* Beyaz metin */
        }

    </style>
</head>
<body>
    <div class="quiz-container">
        <h3 style="margin-bottom: 20px; color: #ffc107;">ðŸŽ¯ Quizler</h3>
        
        <div class="quiz-category-tabs" style="display: flex; margin-bottom: 20px; border-radius: 10px; overflow: hidden;">
            <button class="quiz-category-tab active" id="tab-promosyon" onclick="showQuizCategory('promosyon')" style="flex: 1; padding: 10px; text-align: center; cursor: pointer; background: #ffc107; color: #0a1f44; font-weight: bold; transition: all 0.3s ease;">
                Promosyon Quizleri
            </button>
            <button class="quiz-category-tab" id="tab-saglayici" onclick="showQuizCategory('saglayici')" style="flex: 1; padding: 10px; text-align: center; cursor: pointer; background: #1a3a6b; color: #ffffff; font-weight: bold; transition: all 0.3s ease;">
                SaÄŸlayÄ±cÄ± Quizleri
            </button>
        </div>

        <div class="form-group" style="margin-bottom: 20px;">
            <label>Quiz Yapmak Ä°stediÄŸiniz Promosyonu SeÃ§in:</label>
            <select id="promo-select" onchange="loadQuiz()" style="width: 100%; padding: 10px; border: 1px solid #dee2e6; border-radius: 8px;">
                <option value="">Promosyon seÃ§in...</option>
            </select>
        </div>

        <div id="quiz-content" style="display: none;">
            <div class="quiz-question" id="quiz-question">
                Soru yÃ¼kleniyor...
            </div>
            <div class="quiz-options" id="quiz-options">
                <!-- SeÃ§enekler buraya yÃ¼klenecek -->
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="quiz-button" onclick="checkAnswer()" id="check-btn">CevabÄ± Kontrol Et</button>
                <button class="quiz-button" onclick="loadQuiz()" style="background: #ffeb3b; color: #0a1f44;">ðŸ”„ Yeni Soru</button>
            </div>
        </div>

        <div class="score-display" id="score-display" style="display: none;">
            <div id="score-text"></div>
        </div>
    </div>

    <script>
        let currentAnswer = -1;
        let currentQuiz = null;
        let regularPromos = []; // Normal promosyonlar
        let providerPromos = []; // SaÄŸlayÄ±cÄ± promosyonlarÄ±
        let activePromos = []; // Åžu an aktif olan promosyon listesi
        let currentQuizCategory = 'promosyon'; // VarsayÄ±lan olarak promosyon quizleri aktif

        // YardÄ±mcÄ± fonksiyon: Metin temizleme
        function cleanText(text) {
            if (typeof text !== 'string') return text;
            // NumaralandÄ±rma, Ã¶zel karakterler ve fazla boÅŸluklarÄ± temizle
            // CÃ¼mle sonundaki noktalama iÅŸaretlerini kaldÄ±r, ancak sayÄ±larÄ±n iÃ§indeki noktalara dokunma (Ã¶rn. 1.50)
            return text.replace(/^\d+\.\s*/, '') // BaÅŸÄ±ndaki '1. ' gibi numaralandÄ±rmayÄ± kaldÄ±r
                       .replace(/\s*([.,;])\s*$/, '') // CÃ¼mle sonundaki noktalama iÅŸaretlerini kaldÄ±r
                       .replace(/\s+/g, ' ') // Birden fazla boÅŸluÄŸu tek boÅŸluÄŸa Ã§evir
                       .trim();
        }

        // YardÄ±mcÄ± fonksiyon: SayÄ±sal bir deÄŸerden rastgele yanlÄ±ÅŸ seÃ§enekler Ã¼retir
        function generateNumericWrongOptions(correctAnswer, count = 3) {
            const wrongOptions = new Set();
            let numAnswerString = correctAnswer.replace(/[^0-9.,]/g, ''); // Sadece sayÄ±sal karakterler, nokta ve virgÃ¼l kalÄ±r
            
            // EÄŸer binlik ayraÃ§ olarak nokta, ondalÄ±k ayraÃ§ olarak virgÃ¼l kullanÄ±lÄ±yorsa
            // Ã–rnek: "10.000.000,50 EUR" -> "10000000,50" -> "10000000.50"
            // Ã–rnek: "10.000.000 EUR" -> "10000000"
            if (numAnswerString.includes('.') && numAnswerString.includes(',') && numAnswerString.indexOf('.') < numAnswerString.indexOf(',')) {
                numAnswerString = numAnswerString.replace(/\./g, '').replace(',', '.');
            } else if (numAnswerString.includes('.') && !numAnswerString.includes(',') && numAnswerString.lastIndexOf('.') !== numAnswerString.indexOf('.')) {
                // Birden fazla nokta varsa ve virgÃ¼l yoksa, noktalarÄ± binlik ayraÃ§ olarak kabul et
                numAnswerString = numAnswerString.replace(/\./g, '');
            } else if (numAnswerString.includes(',') && !numAnswerString.includes('.')) {
                // Sadece virgÃ¼l varsa, virgÃ¼lÃ¼ ondalÄ±k ayraÃ§ olarak kabul et
                numAnswerString = numAnswerString.replace(',', '.');
            }

            const numAnswer = parseFloat(numAnswerString); // SayÄ±sal deÄŸeri Ã§Ä±kar
            if (isNaN(numAnswer)) return [];

            while (wrongOptions.size < count) {
                let newOption;
                const variation = numAnswer * (0.1 + Math.random() * 0.4); // %10 ila %50 varyasyon
                const operation = Math.random() > 0.5 ? 1 : -1; // ArtÄ±rma veya azaltma
                newOption = Math.round((numAnswer + operation * variation) * 100) / 100; // Ä°ki ondalÄ±k basamaÄŸa yuvarla
                
                // Orijinal birimini koru
                if (correctAnswer.includes("â‚º")) newOption += "â‚º";
                else if (correctAnswer.includes("%")) newOption += "%";
                else if (correctAnswer.includes("EUR")) newOption += " EUR";
                else if (correctAnswer.includes("adet")) newOption += " adet";

                if (newOption.toString() !== correctAnswer && !wrongOptions.has(newOption.toString())) {
                    wrongOptions.add(newOption.toString());
                }
            }
            return Array.from(wrongOptions);
        }

        // YardÄ±mcÄ± fonksiyon: Tarih veya sÃ¼re bilgisinden yanlÄ±ÅŸ seÃ§enekler Ã¼retir
        function generateTimeWrongOptions(correctAnswer, count = 3) {
            const wrongOptions = new Set();
            const phrases = ["24 saat", "48 saat", "72 saat", "1 gÃ¼n", "3 gÃ¼n", "5 gÃ¼n", "1 hafta", "1 ay", "6 ay", "1 yÄ±l", "BelirtilmemiÅŸ", "SÃ¼resiz"];

            while (wrongOptions.size < count) {
                const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
                if (randomPhrase !== correctAnswer && !wrongOptions.has(randomPhrase)) {
                    wrongOptions.add(randomPhrase);
                }
            }
            return Array.from(wrongOptions);
        }

        // YardÄ±mcÄ± fonksiyon: Genel metinlerden yanlÄ±ÅŸ seÃ§enekler Ã¼retir
        function generateGeneralWrongOptions(correctAnswer, allPossibleAnswers, count = 3) {
            const wrongOptions = new Set();
            const genericOptions = ["BelirtilmemiÅŸ", "DeÄŸiÅŸkendir", "Bilgi yok", "GeÃ§ersiz", "Her zaman geÃ§erli", "TÃ¼m oyunlarda", "HiÃ§biri", "FarklÄ± bir koÅŸula baÄŸlÄ±", "Ekstra bir ÅŸart yok", "CanlÄ± destekten Ã¶ÄŸrenilmeli", "Ã–zel bir kod ile", "Sadece yeni Ã¼yelere Ã¶zel", "Sadece spor", "Sadece casino", "CanlÄ± destek", "E-posta", "Ã‡evrim ÅŸartsÄ±z", "Sadece belli gÃ¼nler", "GeÃ§ersiz bonus kodu"];

            const cleanedCorrectAnswer = cleanText(correctAnswer);

            // Populate contextual options, excluding numbers and time
            const contextualOptions = new Set();
            activePromos.forEach(p => {
                if (p.basicInfo) {
                    Object.values(p.basicInfo).forEach(val => {
                        const cleanedVal = cleanText(val);
                        if (cleanedVal !== cleanedCorrectAnswer && !val.match(/^\\d+[.,]?\\d*\\s*[â‚º$â‚¬%]/i) && !val.match(/\\d+\\s*(saat|gÃ¼n|hafta|ay|yÄ±l)/i)) {
                            contextualOptions.add(cleanedVal);
                        }
                    });
                }
                if (p.sections) {
                    const sectionContents = Array.isArray(p.sections) ? p.sections.flatMap(s => s.content || []).filter(item => typeof item === 'string') : 
                                            Object.values(p.sections).flatMap(s => s.content || []).filter(item => typeof item === 'string');
                    sectionContents.forEach(val => {
                        const cleanedVal = cleanText(val);
                        if (cleanedVal !== cleanedCorrectAnswer && !val.match(/^\\d+[.,]?\\d*\\s*[â‚º$â‚¬%]/i) && !val.match(/\\d+\\s*(saat|gÃ¼n|hafta|ay|yÄ±l)/i)) {
                            contextualOptions.add(cleanedVal);
                        }
                    });
                }
            });

            // Create a pool of potential wrong answers
            let pool = Array.from(contextualOptions);
            Array.from(allPossibleAnswers).forEach(opt => {
                const cleanedOpt = cleanText(opt);
                if (cleanedOpt !== cleanedCorrectAnswer && !pool.includes(cleanedOpt)) {
                    pool.push(cleanedOpt);
                }
            });
            
            // Add generic options to the pool if not already present
            genericOptions.forEach(opt => {
                const cleanedOpt = cleanText(opt);
                if (cleanedOpt !== cleanedCorrectAnswer && !pool.includes(cleanedOpt)) {
                    pool.push(cleanedOpt);
                }
            });

            // Shuffle the pool to pick random options
            pool.sort(() => Math.random() - 0.5);

            // Select 'count' unique wrong options
            while (wrongOptions.size < count && pool.length > 0) {
                const option = pool.shift(); // Take from the front of the shuffled pool
                wrongOptions.add(option);
            }
            
            // If still not enough, aggressively add from generic options (already in pool, but ensure minimum count)
            let genericIndex = 0;
            while (wrongOptions.size < count && genericIndex < genericOptions.length) {
                const genOption = cleanText(genericOptions[genericIndex]);
                if (genOption !== cleanedCorrectAnswer && !wrongOptions.has(genOption)) {
                    wrongOptions.add(genOption);
                }
                genericIndex++;
            }

            return Array.from(wrongOptions);
        }

        // Dinamik quiz sorularÄ± oluÅŸturma fonksiyonu
        function generateQuizQuestions(promo) {
            const dynamicQuizzes = [];
            const allContentItems = []; // Hata veren deÄŸiÅŸkeni burada tanÄ±mlÄ±yoruz

            // generateQuizQuestions iÃ§indeki promos.forEach dÃ¶ngÃ¼sÃ¼nÃ¼ activePromos olarak deÄŸiÅŸtir
            activePromos.forEach(p => {
                if (p.basicInfo) allContentItems.push(...Object.values(p.basicInfo).map(cleanText));
                if (p.sections) {
                    const sectionContents = Array.isArray(p.sections) ? p.sections.flatMap(s => s.content || []).filter(item => typeof item === 'string') : 
                                            Object.values(p.sections).flatMap(s => s.content || []).filter(item => typeof item === 'string');
                    allContentItems.push(...sectionContents.map(cleanText));
                }
            });
            const uniqueAllPossibleAnswers = Array.from(new Set(allContentItems)).filter(Boolean);


            // 1. basicInfo'dan sorular oluÅŸturma
            if (promo.basicInfo) {
                for (const key in promo.basicInfo) {
                    if (Object.hasOwnProperty.call(promo.basicInfo, key)) {
                        const answer = cleanText(promo.basicInfo[key]);
                        if (answer && answer !== "Yok" && answer !== "SÃ¼resiz" && answer !== "Her zaman") {
                            const question = `${promo.title} promosyonunda "${key}" nedir?`;
                            let options = [answer]; // DoÄŸru cevap

                            // SayÄ±sal deÄŸerler iÃ§in Ã¶zel yanlÄ±ÅŸ seÃ§enekler
                            if (key.includes("Miktar") || key.includes("YatÄ±rÄ±m") || key.includes("KazanÃ§") || key.includes("Bahis") || key.includes("Freespin") || key.includes("Oran")) {
                                options = options.concat(generateNumericWrongOptions(answer, 3));
                            } else if (key.includes("Tarih") || key.includes("SÃ¼resi") || key.includes("GÃ¼nler")) {
                                options = options.concat(generateTimeWrongOptions(answer, 3));
                            } else if (key.includes("GeÃ§erli Oyunlar") || key.includes("GeÃ§erli MÃ¼sabakalar") || key.includes("YÃ¶ntem")) {
                                // Bu tÃ¼r anahtar kelimeler iÃ§in daha iyi yanlÄ±ÅŸ ÅŸÄ±klar Ã¼retilebilir
                                options = options.concat(generateGeneralWrongOptions(answer, uniqueAllPossibleAnswers, 3));
                            } else {
                                options = options.concat(generateGeneralWrongOptions(answer, uniqueAllPossibleAnswers, 3));
                            }

                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(answer);

                            // Soru tekrarÄ±nÄ± Ã¶nlemek iÃ§in kontrol
                            if (correctIndex !== -1 && options.length > 1 && !dynamicQuizzes.some(q => cleanText(q.question) === cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `${promo.title} promosyonunda "${key}", ${answer} olarak belirtilmiÅŸtir.`
                                });
                            }
                        }
                    }
                }
            }

            // 2. sections'tan sorular oluÅŸturma (daha derinlemesine)
            if (promo.sections) {
                const allSectionTitles = [];

                if (typeof promo.sections === 'object' && !Array.isArray(promo.sections)) {
                    for (const sectionKey in promo.sections) {
                        if (Object.hasOwnProperty.call(promo.sections, sectionKey)) {
                            const section = promo.sections[sectionKey];
                            allSectionTitles.push(cleanText(section.title));
                            if (section.content && Array.isArray(section.content)) {
                                allContentItems.push(...section.content.map(cleanText));
                            }
                            if (section.items && Array.isArray(section.items)) {
                                allContentItems.push(...section.items.map(cleanText));
                            }
                        }
                    }
                } else if (Array.isArray(promo.sections)) {
                    promo.sections.forEach(section => {
                        allSectionTitles.push(cleanText(section.title));
                        if (section.content && typeof section.content === 'string') {
                            allContentItems.push(cleanText(section.content));
                        }
                        if (section.items && Array.isArray(section.items)) {
                            allContentItems.push(...section.items.map(cleanText));
                        }
                    });
                }

                allContentItems.forEach(item => {
                    // Ortak soru kalÄ±plarÄ± iÃ§in regex match'ler

                    // Minimum yatÄ±rÄ±m miktarÄ± sorularÄ±
                    let match = item.match(/(?:minimum|en az)\s*(\d+[.,]?\d*\s*[â‚º$â‚¬]|\d+\s*Freespin|\d+\s*TL|\d+\s*EUR|\d+\s*adet)\s*(?:tutarÄ±nda|yatÄ±rÄ±m|bahis)/i);
                    if (match) {
                        const amount = cleanText(match[1]);
                        const question = `Bu promosyondan yararlanmak iÃ§in minimum yatÄ±rÄ±m/bahis miktarÄ± ne kadardÄ±r?`;
                        let options = [amount];
                        options = options.concat(generateNumericWrongOptions(amount, 3));
                        options = options.sort(() => Math.random() - 0.5);
                        const correctIndex = options.indexOf(amount);
                        if (correctIndex !== -1 && options.length > 1 && !dynamicQuizzes.some(q => cleanText(q.question) === cleanText(question))) {
                            dynamicQuizzes.push({
                                question: question,
                                options: options,
                                correct: correctIndex,
                                explanation: `Minimum yatÄ±rÄ±m/bahis miktarÄ± ${amount} olarak belirtilmiÅŸtir.`
                            });
                        }
                    }

                    // Maksimum freespin/bonus miktarÄ± sorularÄ±
                    match = item.match(/maksimum\s*(\d+[.,]?\d*\s*[â‚º$â‚¬]|\d+\s*Freespin|\d+\s*adet)\s*(?:kazanÃ§|freebet|bonus miktarÄ±|freespin)/i);
                    if (match) {
                        const amount = cleanText(match[1]);
                        const question = `Bu promosyonda alÄ±nabilecek maksimum ${match[2].toLowerCase().includes('freespin') ? 'freespin' : 'bonus/kazanÃ§'} miktarÄ± ne kadardÄ±r?`;
                        let options = [amount];
                        options = options.concat(generateNumericWrongOptions(amount, 3));
                        options = options.sort(() => Math.random() - 0.5);
                        const correctIndex = options.indexOf(amount);
                        if (correctIndex !== -1 && options.length > 1 && !dynamicQuizzes.some(q => cleanText(q.question) === cleanText(question))) {
                            dynamicQuizzes.push({
                                question: question,
                                options: options,
                                correct: correctIndex,
                                explanation: `Maksimum ${match[2].toLowerCase().includes('freespin') ? 'freespin' : 'bonus/kazanÃ§'} miktarÄ± ${amount} olarak belirtilmiÅŸtir.`
                            });
                        }
                    }

                    // GeÃ§erlilik sÃ¼resi sorularÄ± (daha genel)
                    match = item.match(/(?:geÃ§erlilik sÃ¼resi|\d+\s*(saat|gÃ¼n|hafta|ay|yÄ±l)\s*iÃ§inde kullanÄ±lmalÄ±dÄ±r|\d+\s*(saat|gÃ¼n|hafta|ay|yÄ±l)\s*geÃ§erlidir)/i);
                    if (match) {
                        const duration = cleanText(match[0].toLowerCase().includes('geÃ§erlilik sÃ¼resi') ? item.split(/geÃ§erlilik sÃ¼resi\s*[:-]?\s*/i)[1].split(/\.|,|olmaktadÄ±r/i)[0].trim() : match[0]);
                        if (duration && duration !== "SÃ¼resiz") {
                            const question = `Bu promosyonun geÃ§erlilik sÃ¼resi ne kadardÄ±r?`;
                            let options = [duration];
                            options = options.concat(generateTimeWrongOptions(duration, 3));
                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(duration);
                            if (correctIndex !== -1 && options.length > 1 && !dynamicQuizzes.some(q => cleanText(q.question) === cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `Promosyonun geÃ§erlilik sÃ¼resi ${duration} olarak belirtilmiÅŸtir.`
                                });
                            }
                        }
                    }
                    
                    // Ã‡evrim ÅŸartÄ± sorularÄ± (daha detaylÄ± regex)
                    match = item.match(/(?:Ã§evrim ÅŸartÄ±|Ã§evrimini tamamlamanÄ±z iÃ§in|Ã§evrim oranÄ±)\s*[:-]?\s*([\d\w%\s.,â‚º]+)(?:\.|\n|$)/i);
                    if (match) {
                        const wager = cleanText(match[1]);
                        if (wager && wager !== "Yok" && wager !== "BulunmamaktadÄ±r") {
                            const question = `Bu promosyonun Ã§evrim ÅŸartÄ± nedir?`;
                            let options = [wager];
                            options = options.concat(generateGeneralWrongOptions(wager, uniqueAllPossibleAnswers, 3));
                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(wager);
                            if (correctIndex !== -1 && options.length > 1 && !dynamicQuizzes.some(q => cleanText(q.question) === cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `Ã‡evrim ÅŸartÄ± ${wager} olarak belirtilmiÅŸtir.`
                                });
                            }
                        }
                    }

                    // GeÃ§erli oyunlar/alanlar/branÅŸlar sorularÄ± (daha esnek regex)
                    match = item.match(/(?:geÃ§erli oyunlar|geÃ§erlidir|kullanÄ±labilir|alanÄ±nda geÃ§erli)\s*[:-]?\s*(.+?)(?:\.|\n|$|hariÃ§|dÄ±ÅŸÄ±nda)/i);
                    if (match && !item.toLowerCase().includes("geÃ§erli deÄŸil") && !item.toLowerCase().includes("hariÃ§")) { 
                        const games = match[1].split(/,|ve|hariÃ§|dÄ±ÅŸÄ±nda|veya/i).map(g => cleanText(g)).filter(g => g.length > 0 && !g.toLowerCase().includes("belirtilmedikÃ§e"));
                        if (games.length > 0) {
                            const correctAnswer = games[0]; 
                            const question = `Bu promosyonda geÃ§erli olan oyun/alan/branÅŸlardan biri hangisidir?`;
                            let options = [correctAnswer];
                            options = options.concat(generateGeneralWrongOptions(correctAnswer, uniqueAllPossibleAnswers, 3));
                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(correctAnswer);
                            if (correctIndex !== -1 && options.length > 1 && !dynamicQuizzes.some(q => cleanText(q.question) === cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `GeÃ§erli oyun/alan/branÅŸlardan biri ${correctAnswer} olarak belirtilmiÅŸtir.`
                                });
                            }
                        }
                    }

                    // Kimler yararlanamaz/dahil deÄŸildir sorularÄ± (Negatif soru tipi)
                    match = item.match(/(?:yararlanamaz|faydalanamaz|dahil deÄŸildir|hariÃ§)\s*[:-]?\s*(.+?)(?:\.|\n|$)/i);
                    if (match) {
                        const cannotBenefit = match[1].split(/,|ve/i).map(g => cleanText(g)).filter(g => g.length > 0);
                        if (cannotBenefit.length > 0) {
                            const correctAnswer = cannotBenefit[0];
                            const question = `AÅŸaÄŸÄ±dakilerden hangisi bu promosyondan yararlanamaz / Ã§evrime dahil deÄŸildir?`;
                            let options = [correctAnswer];
                            options = options.concat(generateGeneralWrongOptions(correctAnswer, uniqueAllPossibleAnswers, 3));
                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(correctAnswer);
                            if (correctIndex !== -1 && options.length > 1 && !dynamicQuizzes.some(q => cleanText(q.question) === cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `${correctAnswer} bu promosyondan yararlanamaz / Ã§evrime dahil deÄŸildir olarak belirtilmiÅŸtir.`
                                });
                            }
                        }
                    }

                    // Talep edilmesi gereken durumlar/Ã¶deme yÃ¶ntemleri
                    match = item.match(/(?:talep edilmesi gerekmektedir|talep etmeniz gerekmektedir|talep edilmeli|yatÄ±rÄ±m yÃ¶ntemi ile yatÄ±rÄ±m yapmanÄ±z gerekmektedir)\s*[:-]?\s*(.+?)(?:\.|\n|$)/i);
                    if (match) {
                        const claimCondition = cleanText(match[1]);
                        if (claimCondition) {
                            const question = `Bu promosyonu talep etmek iÃ§in ne gereklidir veya hangi yatÄ±rÄ±m yÃ¶ntemi kullanÄ±lmalÄ±dÄ±r?`;
                            let options = [claimCondition];
                            options = options.concat(generateGeneralWrongOptions(claimCondition, uniqueAllPossibleAnswers, 3));
                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(claimCondition);
                            if (correctIndex !== -1 && options.length > 1 && !dynamicQuizzes.some(q => cleanText(q.question) === cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `Promosyonun talep edilmesi iÃ§in: ${claimCondition}`
                                });
                            }
                        }
                    }

                    // Bonus durdurma/iptal etme hakkÄ± (daha spesifik)
                    match = item.match(/(?:Hproject|Hitbet)\s*dilediÄŸi zaman bu bonusu durdurma ya da iptal etme hakkÄ±na sahiptir/i);
                    if (match && !dynamicQuizzes.some(q => cleanText(q.question).includes(cleanText("Hproject, promosyonu dilediÄŸi zaman durdurma veya iptal etme hakkÄ±na sahip midir?")))) {
                        dynamicQuizzes.push({
                            question: "Hproject, promosyonu dilediÄŸi zaman durdurma veya iptal etme hakkÄ±na sahip midir?",
                            options: ["Evet", "HayÄ±r", "Sadece Ã¼yelerin onayÄ±yla", "Sadece belirli koÅŸullarda"],
                            correct: 0,
                            explanation: "Evet, Hproject promosyonu dilediÄŸi zaman durdurma veya iptal etme hakkÄ±na sahiptir."
                        });
                    }

                     // Cash Out Ã¶zel sorularÄ± (mevcut sorularÄ± koru ve geliÅŸtir)
                     if (promo.id === 'cash-out') {
                        // Cash Out hangi bahis tÃ¼rlerinde geÃ§erlidir?
                        if (item.includes("Cash Out sadece spor bahislerinde geÃ§erlidir")) {
                            if (!dynamicQuizzes.some(q => cleanText(q.question) === cleanText("Cash Out hangi bahis tÃ¼rlerinde geÃ§erlidir?"))) {
                                dynamicQuizzes.push({
                                    question: "Cash Out hangi bahis tÃ¼rlerinde geÃ§erlidir?",
                                    options: [
                                        "Casino oyunlarÄ±nda",
                                        "Sadece canlÄ± bahislerde",
                                        "Spor bahislerinde",
                                        "Slot oyunlarÄ±nda"
                                    ],
                                    correct: 2,
                                    explanation: "Cash Out sadece spor bahislerinde geÃ§erlidir."
                                });
                            }
                        }
                        // 1. Cash Out(Bahis Bozdur) Ã¶zelliÄŸinden yararlanabilmeniz iÃ§in bir spor bahsinizin olmasÄ± gerekmektedir.
                        if (item.includes("spor bahsinizin olmasÄ± gerekmektedir")) {
                            if (!dynamicQuizzes.some(q => cleanText(q.question).includes(cleanText("Cash Out kullanmak iÃ§in hangi bahis tÃ¼rÃ¼nde kuponunuz olmalÄ±dÄ±r?")))) {
                                dynamicQuizzes.push({
                                    question: "Cash Out kullanmak iÃ§in hangi bahis tÃ¼rÃ¼nde kuponunuz olmalÄ±dÄ±r?",
                                    options: ["Spor bahsi", "Casino oyunu", "CanlÄ± casino", "Sanal bahis"],
                                    correct: 0,
                                    explanation: "Cash Out Ã¶zelliÄŸinden yararlanabilmek iÃ§in bir spor bahsinizin olmasÄ± gerekmektedir."
                                });
                            }
                        }
                        // 2. Cash Out Ã¶zelliÄŸinden yararlanabilmeniz iÃ§in bahis aldÄ±ÄŸÄ±nÄ±z market tercihinin canlÄ± bahislerde aktif olmasÄ± gerekmektedir.
                        if (item.includes("canlÄ± bahislerde aktif olmasÄ± gerekmektedir")) {
                             if (!dynamicQuizzes.some(q => cleanText(q.question).includes(cleanText("Cash Out'tan yararlanmak iÃ§in bahis aldÄ±ÄŸÄ±nÄ±z market tercihinin hangi durumda olmasÄ± gerekir?")))) {
                                dynamicQuizzes.push({
                                    question: "Cash Out'tan yararlanmak iÃ§in bahis aldÄ±ÄŸÄ±nÄ±z market tercihinin hangi durumda olmasÄ± gerekir?",
                                    options: ["CanlÄ± bahislerde aktif olmasÄ±", "MaÃ§ Ã¶ncesi bahislerde aktif olmasÄ±", "TÃ¼m bahislerde aktif olmasÄ±", "Herhangi bir aktiflik gerekmez"],
                                    correct: 0,
                                    explanation: "Cash Out Ã¶zelliÄŸinden yararlanabilmeniz iÃ§in bahis aldÄ±ÄŸÄ±nÄ±z market tercihinin canlÄ± bahislerde aktif olmasÄ± gerekmektedir."
                                });
                            }
                        }
                        // 3. Ã–rnek olarak MS1 oynadÄ±ÄŸÄ±nÄ±z mÃ¼sabaka canlÄ±da 3-0 Ã¶nde ve ev sahibi kazanÄ±r oranÄ± aktif deÄŸil ise(3-0 olmasÄ± sebebiyle ev sahibi kazanÄ±r oranÄ± olmayabilir) cash out seÃ§eneÄŸi aktif olmayacaktÄ±r.
                        if (item.includes("cash out seÃ§eneÄŸi aktif olmayacaktÄ±r.") && item.includes("oranÄ± aktif deÄŸil ise")) {
                            if (!dynamicQuizzes.some(q => cleanText(q.question).includes(cleanText("Hangi durumda Cash Out aktif olmayabilir?")))) {
                                dynamicQuizzes.push({
                                    question: "Hangi durumda Cash Out aktif olmayabilir?",
                                    options: ["Bahis oynadÄ±ÄŸÄ±nÄ±z marketin oranÄ± aktif deÄŸilse", "MaÃ§ sonucu berabere ise", "MaÃ§ henÃ¼z baÅŸlamamÄ±ÅŸsa", "YatÄ±rÄ±m miktarÄ±nÄ±z az ise"],
                                    correct: 0,
                                    explanation: "Bahis oynadÄ±ÄŸÄ±nÄ±z market tercihinin canlÄ± bahislerde aktif olmamasÄ± durumunda cash out seÃ§eneÄŸi aktif olmayacaktÄ±r."
                                });
                            }
                        }
                        // 4. Cash Out seÃ§eneÄŸi hemen hemen her karÅŸÄ±laÅŸmada mevcuttur. KuponlarÄ±m sayfasÄ±nda Cash Out(Bahis Bozdur) ibaresini gÃ¶rdÃ¼ÄŸÃ¼nÃ¼z her kuponda bu seÃ§eneÄŸi deÄŸerlendirebilirsiniz.
                        if (item.includes("hemen hemen her karÅŸÄ±laÅŸmada mevcuttur")) {
                            if (!dynamicQuizzes.some(q => cleanText(q.question).includes(cleanText("Cash Out seÃ§eneÄŸi hakkÄ±nda doÄŸru ifade hangisidir?")))) {
                                dynamicQuizzes.push({
                                    question: "Cash Out seÃ§eneÄŸi hakkÄ±nda doÄŸru ifade hangisidir?",
                                    options: ["Hemen hemen her karÅŸÄ±laÅŸmada mevcuttur", "Sadece bÃ¼yÃ¼k liglerde mevcuttur", "Sadece tekli bahislerde mevcuttur", "HiÃ§bir karÅŸÄ±laÅŸmada mevcut deÄŸildir"],
                                    correct: 0,
                                    explanation: "Cash Out seÃ§eneÄŸi hemen hemen her karÅŸÄ±laÅŸmada mevcuttur."
                                });
                            }
                        }
                        // Bahis bozdur Ã¶zelliÄŸi bulunan bahisler, karÅŸÄ±laÅŸmanÄ±n ertelenmesi durumunda bahis-bozdur Ã¶zelliÄŸini kaybeder.
                        if (item.includes("karÅŸÄ±laÅŸmanÄ±n ertelenmesi durumunda bahis-bozdur Ã¶zelliÄŸini kaybeder")) {
                            if (!dynamicQuizzes.some(q => cleanText(q.question).includes(cleanText("KarÅŸÄ±laÅŸmanÄ±n ertelenmesi Cash Out Ã¶zelliÄŸini nasÄ±l etkiler?")))) {
                                dynamicQuizzes.push({
                                    question: "KarÅŸÄ±laÅŸmanÄ±n ertelenmesi Cash Out Ã¶zelliÄŸini nasÄ±l etkiler?",
                                    options: ["Ã–zelliÄŸi kaybeder", "Daha yÃ¼ksek oran sunar", "Otomatik olarak bozulur", "DeÄŸiÅŸmeden kalÄ±r"],
                                    correct: 0,
                                    explanation: "Bahis bozdur Ã¶zelliÄŸi bulunan bahisler, karÅŸÄ±laÅŸmanÄ±n ertelenmesi durumunda bahis-bozdur Ã¶zelliÄŸini kaybeder."
                                });
                            }
                        }
                        // Cash Out bahisler Ã§evrime dahil deÄŸildir.
                        if (item.includes("Cash Out bahisler Ã§evrime dahil deÄŸildir")) {
                             if (!dynamicQuizzes.some(q => cleanText(q.question).includes(cleanText("Cash Out bahisleri Ã§evrim ÅŸartÄ±na dahil midir?")))) {
                                dynamicQuizzes.push({
                                    question: "Cash Out bahisleri Ã§evrim ÅŸartÄ±na dahil midir?",
                                    options: ["HayÄ±r, dahil deÄŸildir", "Evet, tamamen dahildir", "KÄ±smen dahildir", "Sadece belirli durumlarda dahildir"],
                                    correct: 0,
                                    explanation: "Cash Out bahisler Ã§evrime dahil deÄŸildir."
                                });
                            }
                        }
                    }

                    // Kalamba Ã¶zel sorularÄ±
                    if (promo.id === 'kalamba-cash-drop') {
                        // Minimum bahis tutarÄ±
                        match = item.match(/en az\s*(\d+)\s*TL tutarÄ±nda bahis almanÄ±z gerekmektedir/i);
                        if (match) {
                            const amount = cleanText(match[1] + " TL");
                            const question = `Kalamba Cash Drop turnuvasÄ±nda Ã¶dÃ¼lden faydalanabilmek iÃ§in en az ne kadar bahis almanÄ±z gerekmektedir?`;
                            let options = [amount];
                            options = options.concat(generateNumericWrongOptions(amount, 3));
                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(amount);
                            if (correctIndex !== -1 && options.length > 1 && !dynamicQuizzes.some(q => cleanText(q.question) === cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `Kalamba Cash Drop turnuvasÄ±nda Ã¶dÃ¼lden faydalanabilmek iÃ§in en az ${amount} tutarÄ±nda bahis almanÄ±z gerekmektedir.`
                                });
                            }
                        }
                        // Turnuva sÃ¼resi
                        match = item.match(/promosyon\s*(\d+)\s*hafta boyunca sÃ¼recek/i);
                        if (match) {
                            const duration = cleanText(match[1] + " hafta");
                            const question = `Kalamba Cash Drop promosyonu kaÃ§ hafta boyunca sÃ¼recektir?`;
                            let options = [duration];
                            options = options.concat(generateTimeWrongOptions(duration, 3));
                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(duration);
                            if (correctIndex !== -1 && options.length > 1 && !dynamicQuizzes.some(q => cleanText(q.question) === cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `Kalamba Cash Drop promosyonu ${duration} boyunca sÃ¼recektir.`
                                });
                            }
                        }
                        // Ã–dÃ¼l daÄŸÄ±tÄ±mÄ±
                        match = item.match(/Ã¶dÃ¼ller\s*bahis deÄŸerlerine gÃ¶re tamamen random olarak daÄŸÄ±tÄ±lmaktadÄ±r/i);
                        if (match) {
                            const answer = cleanText("Bahis deÄŸerlerine gÃ¶re tamamen random olarak");
                            const question = `Kalamba Cash Drop turnuvasÄ±nda Ã¶dÃ¼ller nasÄ±l daÄŸÄ±tÄ±lmaktadÄ±r?`;
                            let options = [answer];
                            options = options.concat(generateGeneralWrongOptions(answer, uniqueAllPossibleAnswers, 3));
                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(answer);
                            if (correctIndex !== -1 && options.length > 1 && !dynamicQuizzes.some(q => cleanText(q.question) === cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `Kalamba Cash Drop turnuvasÄ±nda Ã¶dÃ¼ller ${answer} daÄŸÄ±tÄ±lmaktadÄ±r.`
                                });
                            }
                        }
                    }

                });
            }

            // Toplamda 30-40 soru olana kadar genel basicInfo ve title tabanlÄ± sorular eklemeye devam et
            // HalihazÄ±rda eklenmiÅŸ olanlarÄ± kontrol et
            const existingQuestions = new Set(dynamicQuizzes.map(q => cleanText(q.question)));

            if (promo.basicInfo) {
                for (const key in promo.basicInfo) {
                    if (Object.hasOwnProperty.call(promo.basicInfo, key)) {
                        const answer = cleanText(promo.basicInfo[key]);
                        if (answer && answer !== "Yok" && answer !== "SÃ¼resiz" && answer !== "Her zaman") {
                            const question = `${promo.title} promosyonunda "${key}" nedir?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [answer];
                                if (key.includes("Miktar") || key.includes("YatÄ±rÄ±m") || key.includes("KazanÃ§") || key.includes("Bahis") || key.includes("Freespin") || key.includes("Oran")) {
                                    options = options.concat(generateNumericWrongOptions(answer, 3));
                                } else if (key.includes("Tarih") || key.includes("SÃ¼resi") || key.includes("GÃ¼nler")) {
                                    options = options.concat(generateTimeWrongOptions(answer, 3));
                                } else {
                                    options = options.concat(generateGeneralWrongOptions(answer, uniqueAllPossibleAnswers, 3));
                                }
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(answer);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `${promo.title} promosyonunda "${key}", ${answer} olarak belirtilmiÅŸtir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }
                }
            }

            // Promosyonun kendisiyle ilgili genel sorular ekle (eÄŸer yeterli soru yoksa)
            if (dynamicQuizzes.length < 30) {
                // KÄ±sa aÃ§Ä±klama sorusu
                if (promo.shortDesc && promo.shortDesc !== "Yok" && !existingQuestions.has(cleanText(`${promo.title} promosyonunun kÄ±sa aÃ§Ä±klamasÄ± nedir?`))) {
                    const question = `${promo.title} promosyonunun kÄ±sa aÃ§Ä±klamasÄ± nedir?`;
                    const answer = cleanText(promo.shortDesc);
                    let options = [answer];
                    options = options.concat(generateGeneralWrongOptions(answer, uniqueAllPossibleAnswers, 3));
                    options = options.sort(() => Math.random() - 0.5);
                    const correctIndex = options.indexOf(answer);
                    if (correctIndex !== -1 && options.length > 1) {
                        dynamicQuizzes.push({
                            question: question,
                            options: options,
                            correct: correctIndex,
                            explanation: `${promo.title} promosyonunun kÄ±sa aÃ§Ä±klamasÄ±: ${answer}`
                        });
                        existingQuestions.add(cleanText(question));
                    }
                }

                // Anahtar kelime sorusu
                if (promo.keywords) {
                    let keywordsArray = [];
                    if (Array.isArray(promo.keywords)) {
                        keywordsArray = promo.keywords.map(cleanText);
                    } else if (typeof promo.keywords === 'string') {
                        keywordsArray = promo.keywords.split(',').map(k => cleanText(k.trim())).filter(Boolean);
                    }

                    if (keywordsArray.length > 0 && !existingQuestions.has(cleanText(`${promo.title} promosyonunun anahtar kelimelerinden biri nedir?`))) {
                        const question = `${promo.title} promosyonunun anahtar kelimelerinden biri nedir?`;
                        const answer = keywordsArray[0];
                        let options = [answer];
                        options = options.concat(generateGeneralWrongOptions(answer, uniqueAllPossibleAnswers, 3));
                        options = options.sort(() => Math.random() - 0.5);
                        const correctIndex = options.indexOf(answer);
                        if (correctIndex !== -1 && options.length > 1) {
                            dynamicQuizzes.push({
                                question: question,
                                options: options,
                                correct: correctIndex,
                                explanation: `${promo.title} promosyonunun anahtar kelimelerinden biri: ${answer}`
                            });
                            existingQuestions.add(cleanText(question));
                        }
                    }
                }

                 // Genel Bonus KurallarÄ± ile ilgili ek sorular
                if (!existingQuestions.has(cleanText("Hproject genel bonus kurallarÄ± bu promosyonda geÃ§erli midir?"))) {
                    dynamicQuizzes.push({
                        question: "Hproject genel bonus kurallarÄ± bu promosyonda geÃ§erli midir?",
                        options: ["Evet", "HayÄ±r", "KÄ±smen", "Sadece belirli durumlarda"],
                        correct: 0,
                        explanation: "Evet, Hproject genel bonus kurallarÄ± bu promosyonda geÃ§erlidir."
                    });
                    existingQuestions.add(cleanText("Hproject genel bonus kurallarÄ± bu promosyonda geÃ§erli midir?"));
                }

                if (!existingQuestions.has(cleanText("Hproject, promosyonu dilediÄŸi zaman durdurma veya iptal etme hakkÄ±na sahip midir?"))) {
                    dynamicQuizzes.push({
                        question: "Hproject, promosyonu dilediÄŸi zaman durdurma veya iptal etme hakkÄ±na sahip midir?",
                        options: ["Evet", "HayÄ±r", "Sadece Ã¼yelerin onayÄ±yla", "Sadece belirli koÅŸullarda"],
                        correct: 0,
                        explanation: "Evet, Hproject promosyonu dilediÄŸi zaman durdurma veya iptal etme hakkÄ±na sahiptir."
                    });
                    existingQuestions.add(cleanText("Hproject, promosyonu dilediÄŸi zaman durdurma veya iptal etme hakkÄ±na sahip midir?"));
                }

                if (!existingQuestions.has(cleanText("Bonusun kÃ¶tÃ¼ye kullanÄ±lmasÄ± durumunda ne olur?"))) {
                    dynamicQuizzes.push({
                        question: "Bonusun kÃ¶tÃ¼ye kullanÄ±lmasÄ± durumunda ne olur?",
                        options: ["Bonus ve kazanÃ§ geri alÄ±nÄ±r", "Sadece bonus iptal edilir", "ÃœyeliÄŸe geÃ§ici el konulur", "Herhangi bir iÅŸlem yapÄ±lmaz"],
                        correct: 0,
                        explanation: "Bonus veya kazancÄ±nÄ± kÃ¶tÃ¼ye kullanma durumunda Hproject bonus ve kazancÄ± geri alma hakkÄ±na sahiptir."
                    });
                    existingQuestions.add(cleanText("Bonusun kÃ¶tÃ¼ye kullanÄ±lmasÄ± durumunda ne olur?"));
                }

                 // Yeni eklenen yatÄ±rÄ±m ÅŸartÄ± ve yatÄ±rÄ±m yÃ¶ntemi sorularÄ±
                 // Ã–rnek: Minimum yatÄ±rÄ±m tutarÄ± gerektiren promosyonlar iÃ§in genel bir soru
                 const minInvestmentMatch = promo.basicInfo && (promo.basicInfo['Minimum YatÄ±rÄ±m'] || promo.basicInfo['Minimum Bahis']);
                 if (minInvestmentMatch && !minInvestmentMatch.includes("Yok") && !existingQuestions.has(cleanText(`${promo.title} iÃ§in minimum yatÄ±rÄ±m miktarÄ± nedir?`))) {
                     const question = `${promo.title} iÃ§in minimum yatÄ±rÄ±m miktarÄ± nedir?`;
                     const answer = cleanText(minInvestmentMatch);
                     let options = [answer];
                     options = options.concat(generateNumericWrongOptions(answer, 3));
                     options = options.sort(() => Math.random() - 0.5);
                     const correctIndex = options.indexOf(answer);
                     if (correctIndex !== -1 && options.length > 1) {
                         dynamicQuizzes.push({
                             question: question,
                             options: options,
                             correct: correctIndex,
                             explanation: `${promo.title} iÃ§in minimum yatÄ±rÄ±m miktarÄ± ${answer} olarak belirtilmiÅŸtir.`
                         });
                         existingQuestions.add(cleanText(question));
                     }
                 }

                 // Ã–deme yÃ¶ntemleri ile ilgili soru
                 const paymentMethodMatch = allContentItems.find(item => item.match(/(?:yatÄ±rÄ±m yÃ¶ntemi ile yatÄ±rÄ±m yapmanÄ±z gerekmektedir|mobil Ã¶deme ve kredi kartÄ± ile yatÄ±rÄ±m yapan Ã¼yelerimiz bu bonustan yararlanamamaktadÄ±r)/i));
                 if (paymentMethodMatch && !existingQuestions.has(cleanText(`${promo.title} promosyonu iÃ§in geÃ§erli olan/olmayan bir yatÄ±rÄ±m yÃ¶ntemi belirtiniz.`))) {
                     let question = `Bu promosyondan yararlanmak iÃ§in hangi yatÄ±rÄ±m yÃ¶ntemlerinden biri kullanÄ±labilir?`;
                     let answer = cleanText("Belirli yatÄ±rÄ±m yÃ¶ntemleri"); // Genel bir cevap
                     
                     // Daha spesifik bir cevap bulmaya Ã§alÄ±ÅŸ
                     const positiveMethods = paymentMethodMatch.match(/(?:Trinkpara Havale|Trinkpara Papara|Trinkpara Paratim|Trinkpara Pep|Trinkpara Paybol|Trinkpara Popypara|Trinkpara Kripto|AnÄ±nda Kripto)/ig);
                     const negativeMethods = paymentMethodMatch.match(/(?:mobil Ã¶deme|kredi kartÄ±)/ig);

                     if (positiveMethods && positiveMethods.length > 0) {
                         question = `${promo.title} promosyonundan yararlanmak iÃ§in hangi yatÄ±rÄ±m yÃ¶ntemlerinden biri kullanÄ±labilir?`;
                         answer = cleanText(positiveMethods[0]);
                     } else if (negativeMethods && negativeMethods.length > 0) {
                         question = `${promo.title} promosyonundan yararlanamayan bir yatÄ±rÄ±m yÃ¶ntemi hangisidir?`;
                         answer = cleanText(negativeMethods[0]);
                     }

                     let options = [answer];
                     options = options.concat(generateGeneralWrongOptions(answer, uniqueAllPossibleAnswers, 3));
                     options = options.sort(() => Math.random() - 0.5);
                     const correctIndex = options.indexOf(answer);
                     if (correctIndex !== -1 && options.length > 1) {
                         dynamicQuizzes.push({
                             question: question,
                             options: options,
                             correct: correctIndex,
                             explanation: `${promo.title} promosyonu iÃ§in yatÄ±rÄ±m yÃ¶ntemi bilgisi: ${answer}`
                         });
                         existingQuestions.add(cleanText(question));
                     }
                 }

                 // Anapara Ã§evrimi ile ilgili genel soru
                 const anaparaCevrimiMatch = allContentItems.find(item => item.includes("Anapara Ã‡evrimi"));
                 if (anaparaCevrimiMatch && !existingQuestions.has(cleanText("Anapara Ã§evrimi nedir?"))) {
                      dynamicQuizzes.push({
                         question: "Anapara Ã§evrimi nedir?",
                         options: [
                             "YatÄ±rÄ±m tutarÄ± kadar bahis yapmak",
                             "Bonus tutarÄ± kadar bahis yapmak",
                             "KayÄ±p miktarÄ± kadar bahis yapmak",
                             "Ã‡ekim yapmak iÃ§in bir ÅŸart deÄŸildir"
                         ],
                         correct: 0,
                         explanation: "Anapara Ã§evrimi, yatÄ±rÄ±m tutarÄ± kadar bahis yapÄ±lmasÄ± anlamÄ±na gelir."
                     });
                     existingQuestions.add(cleanText("Anapara Ã§evrimi nedir?"));
                 }

                 // Ã‡evrimsiz yatÄ±rÄ±m bonusu ile ilgili genel soru
                 const cevrimsizYatirimMatch = allContentItems.find(item => item.includes("Ã‡evrimsiz YatÄ±rÄ±m Bonusu"));
                 if (cevrimsizYatirimMatch && !existingQuestions.has(cleanText("Ã‡evrimsiz yatÄ±rÄ±m bonusunun temel Ã¶zelliÄŸi nedir?"))) {
                     dynamicQuizzes.push({
                         question: "Ã‡evrimsiz yatÄ±rÄ±m bonusunun temel Ã¶zelliÄŸi nedir?",
                         options: [
                             "Ã‡evrim ÅŸartÄ± gerektirmez",
                             "Sadece belirli oyunlarda geÃ§erlidir",
                             "Ã‡ok yÃ¼ksek Ã§evrim ÅŸartÄ± vardÄ±r",
                             "Sadece ilk yatÄ±rÄ±ma Ã¶zeldir"
                         ],
                         correct: 0,
                         explanation: "Ã‡evrimsiz yatÄ±rÄ±m bonusu, adÄ±ndan da anlaÅŸÄ±lacaÄŸÄ± gibi ekstra bir Ã§evrim ÅŸartÄ± gerektirmez."
                     });
                     existingQuestions.add(cleanText("Ã‡evrimsiz yatÄ±rÄ±m bonusunun temel Ã¶zelliÄŸi nedir?"));
                 }

                 // KayÄ±p bonusu ile ilgili genel soru
                 const kayipBonusuMatch = allContentItems.find(item => item.includes("KayÄ±p Bonusu"));
                 if (kayipBonusuMatch && !existingQuestions.has(cleanText("KayÄ±p bonusundan yararlanmak iÃ§in genellikle hangi ÅŸart aranÄ±r?"))) {
                     dynamicQuizzes.push({
                         question: "KayÄ±p bonusundan yararlanmak iÃ§in genellikle hangi ÅŸart aranÄ±r?",
                         options: [
                             "Bakiyenin tamamen sÄ±fÄ±rlanmasÄ±",
                             "YÃ¼ksek miktarda yatÄ±rÄ±m yapÄ±lmasÄ±",
                             "Belirli bir oyun tÃ¼rÃ¼nde kayÄ±p yaÅŸanmasÄ±",
                             "Bonus talep edilmemesi"
                         ],
                         correct: 0,
                         explanation: "KayÄ±p bonusundan yararlanmak iÃ§in genellikle bakiyenin belirli bir seviyenin altÄ±na dÃ¼ÅŸmesi veya tamamen sÄ±fÄ±rlanmasÄ± ÅŸartÄ± aranÄ±r."
                     });
                     existingQuestions.add(cleanText("KayÄ±p bonusundan yararlanmak iÃ§in genellikle hangi ÅŸart aranÄ±r?"));
                 }

                  // Freebet kullanÄ±mÄ± ile ilgili genel soru
                 const freebetMatch = allContentItems.find(item => item.includes("Freebet") && item.includes("kombine kuponlarda kullanÄ±labilir"));
                 if (freebetMatch && !existingQuestions.has(cleanText("Freebet genellikle hangi tÃ¼r kuponlarda kullanÄ±labilir?"))) {
                     const matchKombine = freebetMatch.match(/(\d+\'lÃ¼|kombine)\s*kuponlarda/i);
                     let answer = "Kombine kuponlarda";
                     if (matchKombine) { answer = cleanText(matchKombine[0]); }

                     dynamicQuizzes.push({
                         question: "Freebet genellikle hangi tÃ¼r kuponlarda kullanÄ±labilir?",
                         options: [
                             answer,
                             "Tekli kuponlarda",
                             "CanlÄ± bahislerde",
                             "Sadece casino oyunlarÄ±nda"
                         ],
                         correct: 0,
                         explanation: `Freebet genellikle ${answer} kullanÄ±labilir.`
                     });
                     existingQuestions.add(cleanText("Freebet genellikle hangi tÃ¼r kuponlarda kullanÄ±labilir?"));
                 }
            }


            return dynamicQuizzes;
        }

        let askedQuizIndices = {}; // Her promosyon iÃ§in sorulan quiz indekslerini tutacak

        async function loadPromosData() {
            try {
                const promoFiles = [
                    'ertesi-gun.json',
                    'bonus-buy.json',
                    'hos-geldin.json',
                    'spor-freebet.json',
                    'casino-kayip-bonusu.json',
                    'freespin-600.json',
                    'cash-out.json'
                ];

                const providerPromoFiles = [
                    'pragmatic-play.json',
                    'kalamba-cash-drop.json'
                ];

                regularPromos = [];
                providerPromos = [];

                // Normal promosyonlarÄ± yÃ¼kle
                for (const file of promoFiles) {
                    try {
                        const promoResponse = await fetch(`../promosyonlar/${file}`);
                        if (promoResponse.ok) {
                            const promo = await promoResponse.json();
                            // Pragmatic Play'in yanlÄ±ÅŸlÄ±kla burada olmadÄ±ÄŸÄ±ndan emin ol
                            if (promo.id !== 'pragmatic-play') {
                                regularPromos.push(promo);
                            }
                        }
                    } catch (error) {
                        console.error(`Error loading regular promo ${file}:`, error);
                    }
                }

                // SaÄŸlayÄ±cÄ± promosyonlarÄ±nÄ± yÃ¼kle
                for (const file of providerPromoFiles) {
                    try {
                        const promoResponse = await fetch(`../promosyonlar/${file}`);
                        if (promoResponse.ok) {
                            const promo = await promoResponse.json();
                            providerPromos.push(promo);
                        }
                    } catch (error) {
                        console.error(`Error loading provider promo ${file}:`, error);
                    }
                }

                // BaÅŸlangÄ±Ã§ta aktif promosyonlarÄ± ayarla ve select box'Ä± gÃ¼ncelle
                showQuizCategory(currentQuizCategory);
            } catch (error) {
                console.error('Error loading all promos data:', error);
            }
        }

        function updatePromoSelect() {
            const select = document.getElementById('promo-select');
            select.innerHTML = '<option value="">Promosyon seÃ§in...</option>';
            
            activePromos.forEach(promo => {
                // Hem manuel hem de dinamik olarak oluÅŸturulan quizlerin varlÄ±ÄŸÄ±nÄ± kontrol et
                const hasManualQuizzes = promo.quiz && (Array.isArray(promo.quiz) && promo.quiz.length > 0 || typeof promo.quiz === 'object' && Object.keys(promo.quiz).length > 0);
                const dynamicQuizzes = generateQuizQuestions(promo);
                const hasDynamicQuizzes = dynamicQuizzes.length > 0;

                if (hasManualQuizzes || hasDynamicQuizzes) {
                    const option = document.createElement('option');
                    option.value = promo.id;
                    option.textContent = promo.title;
                    select.appendChild(option);
                }
            });
        }

        function showQuizCategory(category) {
            currentQuizCategory = category;

            // Tab butonlarÄ±nÄ±n stilini gÃ¼ncelle
            document.querySelectorAll('.quiz-category-tab').forEach(tab => {
                tab.style.background = '#1a3a6b';
                tab.style.color = '#ffffff';
                tab.classList.remove('active');
            });

            const activeTab = document.getElementById(`tab-${category}`);
            activeTab.style.background = '#ffc107';
            activeTab.style.color = '#0a1f44';
            activeTab.classList.add('active');

            // Aktif promosyon listesini ayarla
            if (category === 'promosyon') {
                activePromos = regularPromos;
            } else if (category === 'saglayici') {
                activePromos = providerPromos;
            }

            // Promosyon seÃ§imini ve quiz iÃ§eriÄŸini sÄ±fÄ±rla
            document.getElementById('promo-select').value = '';
            document.getElementById('quiz-content').style.display = 'none';
            document.getElementById('score-display').style.display = 'none';

            updatePromoSelect(); // Yeni listeye gÃ¶re seÃ§im kutusunu gÃ¼ncelle
        }

        function loadQuiz() {
            const selectedPromo = document.getElementById('promo-select').value;
            if (!selectedPromo) {
                document.getElementById('quiz-content').style.display = 'none';
                return;
            }

            const promo = activePromos.find(p => p.id === selectedPromo);
            if (!promo) {
                document.getElementById('quiz-content').style.display = 'none';
                alert('Bu promosyon iÃ§in quiz bulunamadÄ±!');
                return;
            }
            
            let allQuizzes = [];

            // Mevcut (manuel olarak eklenmiÅŸ) quizleri ekle
            if (promo.quiz) {
                allQuizzes = allQuizzes.concat(Array.isArray(promo.quiz) ? promo.quiz : [promo.quiz]);
            }
            
            // Dinamik olarak oluÅŸturulan quizleri ekle
            const dynamicQuizzes = generateQuizQuestions(promo);
            allQuizzes = allQuizzes.concat(dynamicQuizzes);

            if (allQuizzes.length === 0) {
                document.getElementById('quiz-content').style.display = 'none';
                alert('Bu promosyon iÃ§in quiz bulunamadÄ±!');
                return;
            }

            // Bu promosyon iÃ§in daha Ã¶nce sorulan quiz indekslerini al
            if (!askedQuizIndices[selectedPromo]) {
                askedQuizIndices[selectedPromo] = [];
            }

            let availableQuizIndices = Array.from({ length: allQuizzes.length }, (_, i) => i);
            availableQuizIndices = availableQuizIndices.filter(index => !askedQuizIndices[selectedPromo].includes(index));

            if (availableQuizIndices.length === 0) {
                alert('Bu promosyon iÃ§in tÃ¼m sorularÄ± yanÄ±tladÄ±nÄ±z! Sorular tekrar edecektir.');
                askedQuizIndices[selectedPromo] = []; // Sorular bittiÄŸinde listeyi sÄ±fÄ±rla
                availableQuizIndices = Array.from({ length: allQuizzes.length }, (_, i) => i); // TÃ¼m sorularÄ± tekrar kullanÄ±labilir yap
            }

            const randomAvailableIndex = Math.floor(Math.random() * availableQuizIndices.length);
            const selectedQuizIndex = availableQuizIndices[randomAvailableIndex];

            currentQuiz = allQuizzes[selectedQuizIndex];
            askedQuizIndices[selectedPromo].push(selectedQuizIndex); // Sorulan soruyu iÅŸaretle
            
            document.getElementById('quiz-content').style.display = 'block';
            
            document.getElementById('quiz-question').textContent = currentQuiz.question;
            
            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';
            
            currentQuiz.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'quiz-option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(optionDiv, index);
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('score-display').style.display = 'none';
            document.getElementById('check-btn').disabled = false;
            currentAnswer = -1;
        }

        function selectOption(element, answerIndex) {
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.classList.remove('selected');
                option.classList.remove('correct');
                option.classList.remove('incorrect');
            });
            
            element.classList.add('selected');
            currentAnswer = answerIndex;
        }

        function checkAnswer() {
            if (currentAnswer === -1) {
                alert('LÃ¼tfen bir seÃ§enek seÃ§in!');
                return;
            }

            if (!currentQuiz) return;

            const options = document.querySelectorAll('.quiz-option');
            
            options[currentQuiz.correct].classList.add('correct');
            
            if (currentAnswer !== currentQuiz.correct) {
                options[currentAnswer].classList.add('incorrect');
            }

            document.getElementById('check-btn').disabled = true;
            
            const scoreDisplay = document.getElementById('score-display');
            const scoreText = document.getElementById('score-text');
            
            if (currentAnswer === currentQuiz.correct) {
                scoreText.innerHTML = `ðŸŽ‰ Tebrikler! DoÄŸru cevap!<br><small>${currentQuiz.explanation}</small>`;
                scoreText.style.color = '#28a745';
            } else {
                scoreText.innerHTML = `âŒ YanlÄ±ÅŸ cevap. DoÄŸru cevap: ${currentQuiz.options[currentQuiz.correct]}<br><small>${currentQuiz.explanation}</small>`;
                scoreText.style.color = '#dc3545';
            }
            
            scoreDisplay.style.display = 'block';
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadPromosData();
        });
    </script>
</body>
</html>
