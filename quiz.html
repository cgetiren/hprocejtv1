<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promosyon Quizleri</title>
    <style>
        /* index.html dosyasındaki ilgili CSS stillerini buraya kopyalayacağız */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a1f44;
            color: #ffffff;
            padding: 20px;
        }

        .quiz-container {
            background: #142d5f;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .quiz-question {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #ffc107; /* Sarı */
        }

        .quiz-options {
            display: grid;
            gap: 10px;
        }

        .quiz-option {
            background: #0a1f44;
            border: 2px solid #1a3a6b;
            color: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            border-color: #ffc107;
            background: #1a3a6b;
        }

        .quiz-option.selected {
            border-color: #ffc107;
            background: #ffc107;
            color: #0a1f44;
        }

        .quiz-option.correct {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }

        .quiz-option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }

        .quiz-button {
            background: #ffc107;
            color: #0a1f44;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .quiz-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            background: #ffeb3b;
        }

        .quiz-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .score-display {
            background: #1a3a6b;
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #ffffff;
        }

        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
            background-color: #0a1f44; /* Koyu lacivert */
            color: #ffffff; /* Beyaz metin */
        }

    </style>
</head>
<body>
    <div class="quiz-container">
        <h3 style="margin-bottom: 20px; color: #ffc107;">🎯 Quizler</h3>
        
        <div class="quiz-category-tabs" style="display: flex; margin-bottom: 20px; border-radius: 10px; overflow: hidden;">
            <button class="quiz-category-tab active" id="tab-promosyon" onclick="showQuizCategory('promosyon')" style="flex: 1; padding: 10px; text-align: center; cursor: pointer; background: #ffc107; color: #0a1f44; font-weight: bold; transition: all 0.3s ease;">
                Promosyon Quizleri
            </button>
            <button class="quiz-category-tab" id="tab-saglayici" onclick="showQuizCategory('saglayici')" style="flex: 1; padding: 10px; text-align: center; cursor: pointer; background: #1a3a6b; color: #ffffff; font-weight: bold; transition: all 0.3s ease;">
                Sağlayıcı Quizleri
            </button>
        </div>

        <div class="form-group" style="margin-bottom: 20px;">
            <label>Quiz Yapmak İstediğiniz Promosyonu Seçin:</label>
            <select id="promo-select" onchange="loadQuiz()" style="width: 100%; padding: 10px; border: 1px solid #dee2e6; border-radius: 8px;">
                <option value="">Promosyon seçin...</option>
            </select>
        </div>

        <div id="quiz-content" style="display: none;">
            <div class="quiz-question" id="quiz-question">
                Soru yükleniyor...
            </div>
            <div class="quiz-options" id="quiz-options">
                <!-- Seçenekler buraya yüklenecek -->
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="quiz-button" onclick="checkAnswer()" id="check-btn">Cevabı Kontrol Et</button>
                <button class="quiz-button" onclick="loadQuiz()" style="background: #ffeb3b; color: #0a1f44;">🔄 Yeni Soru</button>
            </div>
        </div>

        <div class="score-display" id="score-display" style="display: none;">
            <div id="score-text"></div>
        </div>
    </div>

    <script>
        let currentAnswer = -1;
        let currentQuiz = null;
        let regularPromos = []; // Normal promosyonlar
        let providerPromos = []; // Sağlayıcı promosyonları
        let activePromos = []; // Şu an aktif olan promosyon listesi
        let currentQuizCategory = 'promosyon'; // Varsayılan olarak promosyon quizleri aktif

        // Yardımcı fonksiyon: Metin temizleme
        function cleanText(text) {
            if (typeof text !== 'string') return text;
            // Numaralandırma, özel karakterler ve fazla boşlukları temizle
            // Cümle sonundaki noktalama işaretlerini kaldır, ancak sayıların içindeki noktalara dokunma (örn. 1.50)
            return text.replace(/^\d+\.\s*/, '') // Başındaki '1. ' gibi numaralandırmayı kaldır
                       .replace(/([.,;])\s*$/, '') // Cümle sonundaki noktalama işaretlerini kaldır
                       .replace(/\s+/g, ' ') // Birden fazla boşluğu tek boşluğa çevir
                       .trim();
        }

        // Yardımcı fonksiyon: Sayısal bir değerden rastgele yanlış seçenekler üretir
        function generateNumericWrongOptions(correctAnswer, count = 3) {
            const wrongOptions = new Set();
            let numAnswerString = correctAnswer.replace(/[^0-9.,]/g, ''); // Sadece sayısal karakterler, nokta ve virgül kalır
            
            // Eğer binlik ayraç olarak nokta, ondalık ayraç olarak virgül kullanılıyorsa (örn: 10.000.000,50 EUR)
            if (numAnswerString.includes('.') && numAnswerString.includes(',') && numAnswerString.indexOf('.') < numAnswerString.indexOf(',')) {
                numAnswerString = numAnswerString.replace(/\./g, '').replace(',', '.');
            } else if (numAnswerString.includes('.') && !numAnswerString.includes(',') && numAnswerString.lastIndexOf('.') !== numAnswerString.indexOf('.')) {
                // Birden fazla nokta varsa ve virgül yoksa, noktaları binlik ayraç olarak kabul et (örn: 1.000.000 TL)
                numAnswerString = numAnswerString.replace(/\./g, '');
            } else if (numAnswerString.includes(',') && !numAnswerString.includes('.')) {
                // Sadece virgül varsa, virgülü ondalık ayraç olarak kabul et (örn: 100,50 TL)
                numAnswerString = numAnswerString.replace(',', '.');
            }

            const numAnswer = parseFloat(numAnswerString); // Sayısal değeri çıkar
            if (isNaN(numAnswer)) return [];

            while (wrongOptions.size < count) {
                let newOption;
                const variation = numAnswer * (0.1 + Math.random() * 0.4); // %10 ila %50 varyasyon
                const operation = Math.random() > 0.5 ? 1 : -1; // Artırma veya azaltma
                newOption = (Math.round((numAnswer + operation * variation) * 100) / 100).toLocaleString('tr-TR', { minimumFractionDigits: numAnswerString.includes('.') && numAnswerString.split('.')[1] ? numAnswerString.split('.')[1].length : 0 }); // İki ondalık basamağa yuvarla ve yerel format

                // Orijinal birimini koru
                let unit = '';
                if (correctAnswer.includes('₺')) unit = '₺';
                else if (correctAnswer.includes('%')) unit = '%';
                else if (correctAnswer.includes('EUR')) unit = ' EUR';
                else if (correctAnswer.includes('adet')) unit = ' adet';
                else if (correctAnswer.includes('gün')) unit = ' gün';
                else if (correctAnswer.includes('saat')) unit = ' saat';
                else if (correctAnswer.includes('hafta')) unit = ' hafta';
                else if (correctAnswer.includes('ay')) unit = ' ay';
                else if (correctAnswer.includes('yıl')) unit = ' yıl';
                
                newOption = `${newOption}${unit}`;

                if (cleanText(newOption.toString()) !== cleanText(correctAnswer) && !wrongOptions.has(cleanText(newOption.toString()))) {
                    wrongOptions.add(cleanText(newOption.toString()));
                }
            }
            return Array.from(wrongOptions);
        }

        // Yardımcı fonksiyon: Tarih veya süre bilgisinden yanlış seçenekler üretir
        function generateTimeWrongOptions(correctAnswer, count = 3) {
            const wrongOptions = new Set();
            const phrases = ["24 saat", "48 saat", "72 saat", "1 gün", "3 gün", "5 gün", "1 hafta", "1 ay", "6 ay", "1 yıl", "Belirtilmemiş", "Süresiz", "Pazartesi", "Salı", "Çarşamba", "Perşembe", "Cuma", "Hafta sonları", "Sadece resmi tatillerde"];

            while (wrongOptions.size < count) {
                const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
                if (cleanText(randomPhrase) !== cleanText(correctAnswer) && !wrongOptions.has(cleanText(randomPhrase))) {
                    wrongOptions.add(cleanText(randomPhrase));
                }
            }
            return Array.from(wrongOptions);
        }

        // Yardımcı fonksiyon: Genel metinlerden yanlış seçenekler üretir
        function generateGeneralWrongOptions(correctAnswer, specificCategoryAnswers, count = 3) {
            const wrongOptions = new Set();
            // Daha genel veya kafa karıştırıcı olabilecek seçenekler
            const genericOptions = ["Belirtilmemiş", "Değişkendir", "Bilgi yok", "Geçersiz", "Her zaman geçerli", "Tüm oyunlarda", "Hiçbiri", "Farklı bir koşula bağlı", "Ekstra bir şart yok", "Canlı destekten öğrenilmeli", "Özel bir kod ile", "Sadece yeni üyelere özel", "Sadece spor", "Sadece casino", "Canlı destek", "E-posta", "Çevrim şartsız", "Sadece belli günler", "Geçersiz bonus kodu", "Her yatırım yönteminde", "Sadece mobil ödeme ile", "Sadece kredi kartı ile", "Tüm üyeler", "Sadece VIP üyeler", "Sadece belirli oyunlarda", "Yüksek çevrim şartı", "Düşük çevrim şartı", "Bonus ve anaparanın 1 katı", "Bonusun 3 katı", "Yatırımın 5 katı", "24 saat içinde", "7 gün içinde", "Haftalık", "Aylık", "Belirli yatırım yöntemleri", "Tüm yatırım yöntemleri", "Sadece spor bahisleri", "Sadece canlı casino", "Sadece slot oyunları"];

            const cleanedCorrectAnswer = cleanText(correctAnswer);

            // Kategoriye özel cevaplardan yanlış seçenekleri oluştur
            const categorySpecificWrongOptions = new Set();
            specificCategoryAnswers.forEach(val => {
                const cleanedVal = cleanText(val);
                if (cleanedVal !== cleanedCorrectAnswer && !cleanedVal.match(/^\d+[.,]?\d*\s*[₺$€%]/i) && !cleanedVal.match(/\d+\s*(saat|gün|hafta|ay|yıl)/i) && !cleanedVal.match(/Pazartesi|Salı|Çarşamba|Perşembe|Cuma|Hafta sonları|Süresiz|Belirtilmemiş/i)) {
                    categorySpecificWrongOptions.add(cleanedVal);
                }
            });
            
            // Pool oluştur: Kategoriye özel yanlış seçenekler + genel seçenekler
            let pool = Array.from(categorySpecificWrongOptions);
            genericOptions.forEach(opt => {
                const cleanedOpt = cleanText(opt);
                if (cleanedOpt !== cleanedCorrectAnswer && !pool.includes(cleanedOpt)) {
                    pool.push(cleanedOpt);
                }
            });

            pool.sort(() => Math.random() - 0.5); // Karıştır

            // Yeterli sayıda yanlış seçenek seç
            while (wrongOptions.size < count && pool.length > 0) {
                const option = pool.shift();
                if (option && option.length > 0) {
                    wrongOptions.add(option);
                }
            }
            return Array.from(wrongOptions);
        }

        // Dinamik quiz soruları oluşturma fonksiyonu
        function generateQuizQuestions(promo) {
            const dynamicQuizzes = [];
            const existingQuestions = new Set(); // Bu promosyon için eklenen soruları takip etmek için

            // Ortak havuzları önceden oluştur
            const allPromos = [...regularPromos, ...providerPromos];

            const allMinInvestmentAmounts = new Set();
            const allMaxAmounts = new Set();
            const allDurations = new Set();
            const allWagerRequirements = new Set();
            const allEligibleItems = new Set();
            const allIneligibleItems = new Set();
            const allClaimConditions = new Set();
            const allKeywords = new Set();

            allPromos.forEach(p => {
                if (p.basicInfo) {
                    for (const key in p.basicInfo) {
                        if (Object.hasOwnProperty.call(p.basicInfo, key)) {
                            const value = cleanText(p.basicInfo[key]);
                            if (key.includes("Miktar") || key.includes("Yatırım") || key.includes("Kazanç") || key.includes("Bahis") || key.includes("Freespin") || key.includes("Oran")) {
                                allMinInvestmentAmounts.add(value);
                                allMaxAmounts.add(value);
                            } else if (key.includes("Tarih") || key.includes("Süresi") || key.includes("Günler")) {
                                allDurations.add(value);
                            } else if (key.includes("Çevrim")) {
                                allWagerRequirements.add(value);
                            } else if (key.includes("Geçerli Oyunlar") || key.includes("Geçerli Müsabakalar") || key.includes("Kullanım")) {
                                allEligibleItems.add(value);
                            }
                        }
                    }
                }
                if (p.sections) {
                    const sectionContents = Array.isArray(p.sections) ? p.sections.flatMap(s => s.content || []).filter(item => typeof item === 'string') : 
                                            Object.values(p.sections).flatMap(s => s.content || []).filter(item => typeof item === 'string');
                    sectionContents.forEach(item => {
                        const cleanedItem = cleanText(item);
                        let match;

                        // Minimum yatırım/bahis
                        match = cleanedItem.match(/(?:minimum|en az)\s*(\d+[.,]?\d*\s*[₺$€]|\d+\s*Freespin|\d+\s*TL|\d+\s*EUR|\d+\s*adet)\s*(?:tutarında|yatırım|bahis|ile yatırım)/i);
                        if (match) allMinInvestmentAmounts.add(cleanText(match[1]));

                        // Maksimum kazanç/bonus/freespin
                        match = cleanedItem.match(/maksimum\s*(\d+[.,]?\d*\s*[₺$€]|\d+\s*Freespin|\d+\s*adet)\s*(?:kazanç|freebet|bonus miktarı|freespin|çevrim ardından ana bakiyeye aktarılacak tutar)/i);
                        if (match) allMaxAmounts.add(cleanText(match[1]));

                        // Geçerlilik süresi
                        match = cleanedItem.match(/(?:geçerlilik süresi|\d+\s*(saat|gün|hafta|ay|yıl)\s*içinde kullanılmalıdır|\d+\s*(saat|gün|hafta|ay|yıl)\s*geçerlidir|promosyon\s*(\d+)\s*hafta boyunca sürecek)/i);
                        if (match) allDurations.add(cleanText(match[0].toLowerCase().includes('geçerlilik süresi') ? cleanedItem.split(/geçerlilik süresi\s*[:-]?\s*/i)[1].split(/\.|,|olmaktadır/i)[0].trim() : match[0]));

                        // Çevrim şartı
                        match = cleanedItem.match(/(?:çevrim şartı|çevrimini tamamlamanız için|çevrim oranı|kazanç miktarının\s*(\d+)\s*katı kadar çevrim yapılmalıdır|çevrim yapılmalıdır)\s*[:-]?\s*([\d\w%\s.,₺]+)(?:\.|\n|$|gerekmektedir)/i);
                        if (match) allWagerRequirements.add(cleanText(match[1] || match[2]));

                        // Geçerli oyunlar/alanlar/branşlar
                        match = cleanedItem.match(/(?:geçerli oyunlar|geçerlidir|kullanılabilir|alanında geçerli)\s*[:-]?\s*(.+?)(?:\.|\n|$|hariç|dışında|veya|ancak)/i);
                        if (match && !cleanedItem.toLowerCase().includes("geçerli değil") && !cleanedItem.toLowerCase().includes("hariç") && !cleanedItem.toLowerCase().includes("dışında")) {
                            match[1].split(/,|ve|hariç|dışında|veya|ancak/i).map(g => cleanText(g)).filter(g => g.length > 0 && !g.toLowerCase().includes("belirtilmedikçe") && !g.toLowerCase().includes("bazı oyunlar çevrime dahil değildir")).forEach(item => allEligibleItems.add(item));
                        }
                        
                        // Kimler yararlanamaz/dahil değildir
                        match = cleanedItem.match(/(?:yararlanamaz|faydalanamaz|dahil değildir|hariç)\s*[:-]?\s*(.+?)(?:\.|\n|$)/i);
                        if (match) {
                            match[1].split(/,|ve/i).map(g => cleanText(g)).filter(g => g.length > 0).forEach(item => allIneligibleItems.add(item));
                        }

                        // Talep koşulları
                        match = cleanedItem.match(/(?:talep edilmesi gerekmektedir|talep etmeniz gerekmektedir|talep edilmeli|yatırım yöntemi ile yatırım yapmanız gerekmektedir|bonus seç kısmına tıklayarak.+?bonusu seçilerek yatırım yapmanız durumunda otomatik olarak bonus buy.+?hesabınıza aktarılacaktır)\s*[:-]?\s*(.+?)(?:\.|\n|$)/i);
                        if (match) allClaimConditions.add(cleanText(match[1] || match[0]));
                    });
                }
                if (p.keywords) {
                    let keywordsArray = Array.isArray(p.keywords) ? p.keywords : p.keywords.split(',').map(k => k.trim());
                    keywordsArray.forEach(k => allKeywords.add(cleanText(k)));
                }
            });

            const uniqueAllMinInvestmentAmounts = Array.from(allMinInvestmentAmounts).filter(Boolean);
            const uniqueAllMaxAmounts = Array.from(allMaxAmounts).filter(Boolean);
            const uniqueAllDurations = Array.from(allDurations).filter(Boolean);
            const uniqueAllWagerRequirements = Array.from(allWagerRequirements).filter(Boolean);
            const uniqueAllEligibleItems = Array.from(allEligibleItems).filter(Boolean);
            const uniqueAllIneligibleItems = Array.from(allIneligibleItems).filter(Boolean);
            const uniqueAllClaimConditions = Array.from(allClaimConditions).filter(Boolean);
            const uniqueAllKeywords = Array.from(allKeywords).filter(Boolean);

            // 1. basicInfo'dan sorular oluşturma
            if (promo.basicInfo) {
                for (const key in promo.basicInfo) {
                    if (Object.hasOwnProperty.call(promo.basicInfo, key)) {
                        const answer = cleanText(promo.basicInfo[key]);
                        if (answer && answer !== "Yok" && answer !== "Süresiz" && answer !== "Her zaman" && answer.length > 3) { // Kısa ve anlamsız cevapları ele
                            const question = `${promo.title} promosyonunda "${key}" nedir?`;
                            if (existingQuestions.has(cleanText(question))) continue; // Soru daha önce eklendi mi kontrol et

                            let options = [answer]; // Doğru cevap

                            if (key.includes("Miktar") || key.includes("Yatırım") || key.includes("Kazanç") || key.includes("Bahis") || key.includes("Freespin") || key.includes("Oran")) {
                                options = options.concat(generateNumericWrongOptions(answer, 3));
                            } else if (key.includes("Tarih") || key.includes("Süresi") || key.includes("Günler")) {
                                options = options.concat(generateTimeWrongOptions(answer, 3));
                            } else {
                                // Genel kategori için, burada daha akıllı bir yanlış seçenek havuzu kullanılmalı
                                // Şimdilik tüm promosyonlardaki basicInfo değerlerini toplayalım
                                const allBasicInfoValues = allPromos.flatMap(p => p.basicInfo ? Object.values(p.basicInfo).map(cleanText) : []).filter(Boolean);
                                options = options.concat(generateGeneralWrongOptions(answer, allBasicInfoValues, 3));
                            }

                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(answer);

                            if (correctIndex !== -1 && options.length > 1) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `${promo.title} promosyonunda "${key}", ${answer} olarak belirtilmiştir.`
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                    }
                }
            }

            // 2. sections'tan sorular oluşturma (daha derinlemesine)
            if (promo.sections) {
                const sectionContents = Array.isArray(promo.sections) ? promo.sections.flatMap(s => s.content || []).filter(item => typeof item === 'string') : 
                                        Object.values(promo.sections).flatMap(s => s.content || []).filter(item => typeof item === 'string');

                sectionContents.forEach(item => {
                    const cleanedItem = cleanText(item);

                    // Minimum yatırım miktarı soruları
                    let match = cleanedItem.match(/(?:minimum|en az)\s*(\d+[.,]?\d*\s*[₺$€]|\d+\s*Freespin|\d+\s*TL|\d+\s*EUR|\d+\s*adet)\s*(?:tutarında|yatırım|bahis|ile yatırım)/i);
                    if (match) {
                        const amount = cleanText(match[1]);
                        const question = `Bu promosyondan yararlanmak için minimum yatırım/bahis miktarı ne kadardır?`;
                        if (!existingQuestions.has(cleanText(question))) {
                            let options = [amount];
                            options = options.concat(generateNumericWrongOptions(amount, 3));
                            options = options.concat(uniqueAllMinInvestmentAmounts.filter(val => cleanText(val) !== cleanText(amount)).sort(() => Math.random() - 0.5).slice(0, 2));
                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(amount);
                            if (correctIndex !== -1 && options.length > 1) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `Minimum yatırım/bahis miktarı ${amount} olarak belirtilmiştir.`
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                    }

                    // Maksimum kazanç/bonus/freespin miktarı soruları
                    match = cleanedItem.match(/maksimum\s*(\d+[.,]?\d*\s*[₺$€]|\d+\s*Freespin|\d+\s*adet)\s*(?:kazanç|freebet|bonus miktarı|freespin|çevrim ardından ana bakiyeye aktarılacak tutar)/i);
                    if (match) {
                        const amount = cleanText(match[1]);
                        const type = (match[2] || '').toLowerCase().includes('freespin') ? 'freespin' : 'bonus/kazanç';
                        const question = `Bu promosyonda alınabilecek maksimum ${type} miktarı ne kadardır?`;
                        if (!existingQuestions.has(cleanText(question))) {
                            let options = [amount];
                            options = options.concat(generateNumericWrongOptions(amount, 3));
                            options = options.concat(uniqueAllMaxAmounts.filter(val => cleanText(val) !== cleanText(amount)).sort(() => Math.random() - 0.5).slice(0, 2));
                            options = options.sort(() => Math.random() - 0.5);
                            const correctIndex = options.indexOf(amount);
                            if (correctIndex !== -1 && options.length > 1) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: options,
                                    correct: correctIndex,
                                    explanation: `Maksimum ${type} miktarı ${amount} olarak belirtilmiştir.`
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                    }

                    // Geçerlilik süresi soruları
                    match = cleanedItem.match(/(?:geçerlilik süresi|\d+\s*(saat|gün|hafta|ay|yıl)\s*içinde kullanılmalıdır|\d+\s*(saat|gün|hafta|ay|yıl)\s*geçerlidir|promosyon\s*(\d+)\s*hafta boyunca sürecek)/i);
                    if (match) {
                        let duration = cleanText(match[0].toLowerCase().includes('geçerlilik süresi') ? cleanedItem.split(/geçerlilik süresi\s*[:-]?\s*/i)[1].split(/\.|,|olmaktadır/i)[0].trim() : match[0]);
                        if (match[2]) duration = cleanText(match[2] + ' hafta'); // "30 hafta boyunca sürecek" gibi ifadeler için

                        if (duration && duration !== "Süresiz" && duration !== "Belirtilmemiş" && duration.length > 3) {
                            const question = `Bu promosyonun geçerlilik süresi ne kadardır?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [duration];
                                options = options.concat(generateTimeWrongOptions(duration, 3));
                                options = options.concat(uniqueAllDurations.filter(val => cleanText(val) !== cleanText(duration)).sort(() => Math.random() - 0.5).slice(0, 2));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(duration);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Promosyonun geçerlilik süresi ${duration} olarak belirtilmiştir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }
                    
                    // Çevrim şartı soruları
                    match = cleanedItem.match(/(?:çevrim şartı|çevrimini tamamlamanız için|çevrim oranı|kazanç miktarının\s*(\d+)\s*katı kadar çevrim yapılmalıdır|çevrim yapılmalıdır)\s*[:-]?\s*([\d\w%\s.,₺]+)(?:\.|\n|$|gerekmektedir)/i);
                    if (match) {
                        const wager = cleanText(match[1] || match[2]); // Regex gruplarını kontrol et
                        if (wager && wager !== "Yok" && wager !== "Bulunmamaktadır" && wager !== "Dahil değildir" && wager.length > 3) {
                            const question = `Bu promosyonun çevrim şartı nedir?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [wager];
                                // Sadece aynı kategoriden (çevrim şartları) yanlış şıklar üret
                                options = options.concat(generateGeneralWrongOptions(wager, uniqueAllWagerRequirements, 3));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(wager);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Çevrim şartı ${wager} olarak belirtilmiştir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }

                    // Geçerli oyunlar/alanlar/branşlar soruları
                    match = cleanedItem.match(/(?:geçerli oyunlar|geçerlidir|kullanılabilir|alanında geçerli)\s*[:-]?\s*(.+?)(?:\.|\n|$|hariç|dışında|veya|ancak)/i);
                    if (match && !cleanedItem.toLowerCase().includes("geçerli değil") && !cleanedItem.toLowerCase().includes("hariç") && !cleanedItem.toLowerCase().includes("dışında")) { 
                        const games = match[1].split(/,|ve|hariç|dışında|veya|ancak/i).map(g => cleanText(g)).filter(g => g.length > 0 && !g.toLowerCase().includes("belirtilmedikçe") && !g.toLowerCase().includes("bazı oyunlar çevrime dahil değildir"));
                        if (games.length > 0) {
                            const correctAnswer = games[0]; 
                            const question = `Bu promosyonda geçerli olan oyun/alan/branşlardan biri hangisidir?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [correctAnswer];
                                options = options.concat(generateGeneralWrongOptions(correctAnswer, uniqueAllEligibleItems, 3));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(correctAnswer);
    if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Geçerli oyun/alan/branşlardan biri ${correctAnswer} olarak belirtilmiştir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }

                    // Kimler yararlanamaz/dahil değildir soruları (Negatif soru tipi)
                    match = cleanedItem.match(/(?:yararlanamaz|faydalanamaz|dahil değildir|hariç)\s*[:-]?\s*(.+?)(?:\.|\n|$)/i);
                    if (match) {
                        const cannotBenefit = match[1].split(/,|ve/i).map(g => cleanText(g)).filter(g => g.length > 0);
                        if (cannotBenefit.length > 0) {
                            const correctAnswer = cannotBenefit[0];
                            const question = `Aşağıdakilerden hangisi bu promosyondan yararlanamaz / çevrime dahil değildir?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [correctAnswer];
                                options = options.concat(generateGeneralWrongOptions(correctAnswer, uniqueAllIneligibleItems, 3));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(correctAnswer);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `${correctAnswer} bu promosyondan yararlanamaz / çevrime dahil değildir olarak belirtilmiştir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }

                    // Talep edilmesi gereken durumlar/ödeme yöntemleri
                    match = cleanedItem.match(/(?:talep edilmesi gerekmektedir|talep etmeniz gerekmektedir|talep edilmeli|yatırım yöntemi ile yatırım yapmanız gerekmektedir|bonus seç kısmına tıklayarak.+?bonusu seçilerek yatırım yapmanız durumunda otomatik olarak bonus buy.+?hesabınıza aktarılacaktır)\s*[:-]?\s*(.+?)(?:\.|\n|$)/i);
                    if (match) {
                        const claimCondition = cleanText(match[1] || match[0]); // match[0] tüm eşleşen ifadeyi içerir
                        if (claimCondition && claimCondition.length > 5) { // Kısa ifadeleri filtrele
                            const question = `Bu promosyonu talep etmek için ne gereklidir veya hangi yatırım yöntemi kullanılmalıdır?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [claimCondition];
                                options = options.concat(generateGeneralWrongOptions(claimCondition, uniqueAllClaimConditions, 3));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(claimCondition);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Promosyonun talep edilmesi için: ${claimCondition}`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }

                    // Bonus durdurma/iptal etme hakkı (daha spesifik)
                    if (cleanedItem.match(/(?:Hproject|Hitbet)\s*dilediği zaman bu bonusu durdurma ya da iptal etme hakkına sahiptir/i)) {
                        const question = "Hproject, promosyonu dilediği zaman durdurma veya iptal etme hakkına sahip midir?";
                        if (!existingQuestions.has(cleanText(question))) {
                            dynamicQuizzes.push({
                                question: question,
                                options: ["Evet", "Hayır", "Sadece üyelerin onayıyla", "Sadece belirli koşullarda"],
                                correct: 0,
                                explanation: "Evet, Hproject promosyonu dilediği zaman durdurma veya iptal etme hakkına sahiptir."
                            });
                            existingQuestions.add(cleanText(question));
                        }
                    }
                    
                    // Kötüye kullanım şartı
                    if (cleanedItem.match(/(?:Bonus|kazanç)(?:ını)?\s*kötüye kullanma durumunda\s*(?:Hproject|Hitbet)\s*(?:bonusu ve kazancı geri alma hakkına sahiptir|bonus ve kazanç geri alınır)/i)) {
                        const question = "Bonusun kötüye kullanılması durumunda ne olur?";
                        if (!existingQuestions.has(cleanText(question))) {
                            dynamicQuizzes.push({
                                question: question,
                                options: ["Bonus ve kazanç geri alınır", "Sadece bonus iptal edilir", "Üyeliğe geçici el konulur", "Herhangi bir işlem yapılmaz"],
                                correct: 0,
                                explanation: "Bonus veya kazancını kötüye kullanma durumunda Hproject bonus ve kazancı geri alma hakkına sahiptir."
                            });
                            existingQuestions.add(cleanText(question));
                        }
                    }

                    // Cash Out özel soruları (mevcut soruları koru ve geliştir)
                    if (promo.id === 'cash-out') {
                        // Cash Out hangi bahis türlerinde geçerlidir?
                        if (cleanedItem.includes("Cash Out sadece spor bahislerinde geçerlidir")) {
                            const question = "Cash Out hangi bahis türlerinde geçerlidir?";
                            if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: [
                                        "Casino oyunlarında",
                                        "Sadece canlı bahislerde",
                                        "Spor bahislerinde",
                                        "Slot oyunlarında"
                                    ],
                                    correct: 2,
                                    explanation: "Cash Out sadece spor bahislerinde geçerlidir."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                        // Cash Out kullanmak için hangi bahis türünde kuponunuz olmalıdır?
                        if (cleanedItem.includes("spor bahsinizin olması gerekmektedir")) {
                            const question = "Cash Out kullanmak için hangi bahis türünde kuponunuz olmalıdır?";
                            if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: ["Spor bahsi", "Casino oyunu", "Canlı casino", "Sanal bahis"],
                                    correct: 0,
                                    explanation: "Cash Out özelliğinden yararlanabilmek için bir spor bahsinizin olması gerekmektedir."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                        // Cash Out'tan yararlanmak için bahis aldığınız market tercihinin hangi durumda olması gerekir?
                        if (cleanedItem.includes("canlı bahislerde aktif olması gerekmektedir")) {
                             const question = "Cash Out'tan yararlanmak için bahis aldığınız market tercihinin hangi durumda olması gerekir?";
                             if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: ["Canlı bahislerde aktif olması", "Maç öncesi bahislerde aktif olması", "Tüm bahislerde aktif olması", "Herhangi bir aktiflik gerekmez"],
                                    correct: 0,
                                    explanation: "Cash Out özelliğinden yararlanabilmeniz için bahis aldığınız market tercihinin canlı bahislerde aktif olması gerekmektedir."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                        // Hangi durumda Cash Out aktif olmayabilir?
                        if (cleanedItem.includes("cash out seçeneği aktif olmayacaktır.") && cleanedItem.includes("oranı aktif değil ise")) {
                            const question = "Hangi durumda Cash Out aktif olmayabilir?";
                            if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: ["Bahis oynadığınız marketin oranı aktif değilse", "Maç sonucu berabere ise", "Maç henüz başlamamışsa", "Yatırım miktarınız az ise"],
                                    correct: 0,
                                    explanation: "Bahis oynadığınız market tercihinin canlı bahislerde aktif olmaması durumunda cash out seçeneği aktif olmayacaktır."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                        // Cash Out seçeneği hakkında doğru ifade hangisidir?
                        if (cleanedItem.includes("hemen hemen her karşılaşmada mevcuttur")) {
                            const question = "Cash Out seçeneği hakkında doğru ifade hangisidir?";
                            if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: ["Hemen hemen her karşılaşmada mevcuttur", "Sadece büyük liglerde mevcuttur", "Sadece tekli bahislerde mevcuttur", "Hiçbir karşılaşmada mevcut değildir"],
                                    correct: 0,
                                    explanation: "Cash Out seçeneği hemen hemen her karşılaşmada mevcuttur."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                        // Karşılaşmanın ertelenmesi Cash Out özelliğini nasıl etkiler?
                        if (cleanedItem.includes("karşılaşmanın ertelenmesi durumunda bahis-bozdur özelliğini kaybeder")) {
                            const question = "Karşılaşmanın ertelenmesi Cash Out özelliğini nasıl etkiler?";
                            if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: ["Özelliği kaybeder", "Daha yüksek oran sunar", "Otomatik olarak bozulur", "Değişmeden kalır"],
                                    correct: 0,
                                    explanation: "Bahis bozdur özelliği bulunan bahisler, karşılaşmanın ertelenmesi durumunda bahis-bozdur özelliğini kaybeder."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                        // Cash Out bahisleri çevrim şartına dahil midir?
                        if (cleanedItem.includes("Cash Out bahisler çevrime dahil değildir")) {
                             const question = "Cash Out bahisleri çevrim şartına dahil midir?";
                             if (!existingQuestions.has(cleanText(question))) {
                                dynamicQuizzes.push({
                                    question: question,
                                    options: ["Hayır, dahil değildir", "Evet, tamamen dahildir", "Kısmen dahildir", "Sadece belirli durumlarda dahildir"],
                                    correct: 0,
                                    explanation: "Cash Out bahisler çevrime dahil değildir."
                                });
                                existingQuestions.add(cleanText(question));
                            }
                        }
                    }

                    // Kalamba özel soruları
                    if (promo.id === 'kalamba-cash-drop') {
                        // Minimum bahis tutarı
                        match = cleanedItem.match(/en az\s*(\d+)\s*TL tutarında bahis almanız gerekmektedir/i);
                        if (match) {
                            const amount = cleanText(match[1] + " TL");
                            const question = `Kalamba Cash Drop turnuvasında ödülden faydalanabilmek için en az ne kadar bahis almanız gerekmektedir?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [amount];
                                options = options.concat(generateNumericWrongOptions(amount, 3));
                                options = options.concat(uniqueAllMinInvestmentAmounts.filter(val => cleanText(val) !== cleanText(amount)).sort(() => Math.random() - 0.5).slice(0, 2));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(amount);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Kalamba Cash Drop turnuvasında ödülden faydalanabilmek için en az ${amount} tutarında bahis almanız gerekmektedir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                        // Turnuva süresi
                        match = cleanedItem.match(/promosyon\s*(\d+)\s*hafta boyunca sürecek/i);
                        if (match) {
                            const duration = cleanText(match[1] + " hafta");
                            const question = `Kalamba Cash Drop promosyonu kaç hafta boyunca sürecektir?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [duration];
                                options = options.concat(generateTimeWrongOptions(duration, 3));
                                options = options.concat(uniqueAllDurations.filter(val => cleanText(val) !== cleanText(duration)).sort(() => Math.random() - 0.5).slice(0, 2));
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(duration);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Kalamba Cash Drop promosyonu ${duration} boyunca sürecektir.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                        // Ödül dağıtımı
                        match = cleanedItem.match(/ödüller\s*bahis değerlerine göre tamamen random olarak dağıtılmaktadır/i);
                        if (match) {
                            const answer = cleanText("Bahis değerlerine göre tamamen random olarak");
                            const question = `Kalamba Cash Drop turnuvasında ödüller nasıl dağıtılmaktadır?`;
                            if (!existingQuestions.has(cleanText(question))) {
                                let options = [answer];
                                options = options.concat(generateGeneralWrongOptions(answer, uniqueAllEligibleItems, 3)); // Burada daha genel bir havuz kullanmak mantıklı olabilir
                                options = options.sort(() => Math.random() - 0.5);
                                const correctIndex = options.indexOf(answer);
                                if (correctIndex !== -1 && options.length > 1) {
                                    dynamicQuizzes.push({
                                        question: question,
                                        options: options,
                                        correct: correctIndex,
                                        explanation: `Kalamba Cash Drop turnuvasında ödüller ${answer} dağıtılmaktadır.`
                                    });
                                    existingQuestions.add(cleanText(question));
                                }
                            }
                        }
                    }
                });
            }

            // Genel Bonus Kuralları ile ilgili ek sorular (tüm promosyonlara uygulanabilir)
            const generalRulesQuestions = [
                {
                    question: "Hproject genel bonus kuralları bu promosyonda geçerli midir?",
                    options: ["Evet", "Hayır", "Kısmen", "Sadece belirli durumlarda"],
                    correct: 0,
                    explanation: "Evet, Hproject genel bonus kuralları bu promosyonda geçerlidir."
                },
                {
                    question: "Hproject, promosyonu dilediği zaman durdurma veya iptal etme hakkına sahip midir?",
                    options: ["Evet", "Hayır", "Sadece üyelerin onayıyla", "Sadece belirli koşullarda"],
                    correct: 0,
                    explanation: "Evet, Hproject promosyonu dilediği zaman durdurma veya iptal etme hakkına sahiptir."
                },
                {
                    question: "Bonusun kötüye kullanılması durumunda ne olur?",
                    options: ["Bonus ve kazanç geri alınır", "Sadece bonus iptal edilir", "Üyeliğe geçici el konulur", "Herhangi bir işlem yapılmaz"],
                    correct: 0,
                    explanation: "Bonus veya kazancını kötüye kullanma durumunda Hproject bonus ve kazancı geri alma hakkına sahiptir."
                }
            ];

            generalRulesQuestions.forEach(q => {
                if (!existingQuestions.has(cleanText(q.question))) {
                    dynamicQuizzes.push(q);
                    existingQuestions.add(cleanText(q.question));
                }
            });

            // Promosyonun kendisiyle ilgili genel sorular ekle (eğer yeterli soru yoksa)
            if (dynamicQuizzes.length < 30) {
                // Kısa açıklama sorusu
                if (promo.shortDesc && promo.shortDesc !== "Yok" && promo.shortDesc.length > 3 && !existingQuestions.has(cleanText(`${promo.title} promosyonunun kısa açıklaması nedir?`))) {
                    const question = `${promo.title} promosyonunun kısa açıklaması nedir?`;
                    const answer = cleanText(promo.shortDesc);
                    let options = [answer];
                    // Genel kategori için, burada daha akıllı bir yanlış seçenek havuzu kullanılmalı
                    const allShortDescriptions = allPromos.map(p => cleanText(p.shortDesc)).filter(Boolean);
                    options = options.concat(generateGeneralWrongOptions(answer, allShortDescriptions, 3));
                    options = options.sort(() => Math.random() - 0.5);
                    const correctIndex = options.indexOf(answer);
                    if (correctIndex !== -1 && options.length > 1) {
                        dynamicQuizzes.push({
                            question: question,
                            options: options,
                            correct: correctIndex,
                            explanation: `${promo.title} promosyonunun kısa açıklaması: ${answer}`
                        });
                        existingQuestions.add(cleanText(question));
                    }
                }

                // Anahtar kelime sorusu
                let keywordsArray = [];
                if (Array.isArray(promo.keywords)) {
                    keywordsArray = promo.keywords.map(cleanText);
                } else if (typeof promo.keywords === 'string') {
                    keywordsArray = promo.keywords.split(',').map(k => cleanText(k.trim())).filter(Boolean);
                }
                
                if (keywordsArray.length > 0 && !existingQuestions.has(cleanText(`${promo.title} promosyonunun anahtar kelimelerinden biri nedir?`))) {
                    const question = `${promo.title} promosyonunun anahtar kelimelerinden biri nedir?`;
                    const answer = keywordsArray[0];
                    let options = [answer];
                    options = options.concat(generateGeneralWrongOptions(answer, uniqueAllKeywords, 3));
                    options = options.sort(() => Math.random() - 0.5);
                    const correctIndex = options.indexOf(answer);
                    if (correctIndex !== -1 && options.length > 1) {
                        dynamicQuizzes.push({
                            question: question,
                            options: options,
                            correct: correctIndex,
                            explanation: `${promo.title} promosyonunun anahtar kelimelerinden biri: ${answer}`
                        });
                        existingQuestions.add(cleanText(question));
                    }
                }
            }

            // Son olarak, quiz sayısını hedeflemek için yeterli soru yoksa, kalan boşlukları doldurmak için genel basicInfo sorularını tekrar dene
            if (dynamicQuizzes.length < 30) {
                if (promo.basicInfo) {
                    for (const key in promo.basicInfo) {
                        if (Object.hasOwnProperty.call(promo.basicInfo, key)) {
                            const answer = cleanText(promo.basicInfo[key]);
                            if (answer && answer !== "Yok" && answer !== "Süresiz" && answer !== "Her zaman" && answer.length > 3) {
                                const question = `${promo.title} promosyonunda "${key}" nedir?`;
                                if (!existingQuestions.has(cleanText(question))) {
                                    let options = [answer];
                                    // Burada da kategoriye özel havuz kullanılmalı
                                    if (key.includes("Miktar") || key.includes("Yatırım") || key.includes("Kazanç") || key.includes("Bahis") || key.includes("Freespin") || key.includes("Oran")) {
                                        options = options.concat(generateNumericWrongOptions(answer, 3));
                                        options = options.concat(uniqueAllMinInvestmentAmounts.filter(val => cleanText(val) !== cleanText(answer)).sort(() => Math.random() - 0.5).slice(0, 2));
                                    } else if (key.includes("Tarih") || key.includes("Süresi") || key.includes("Günler")) {
                                        options = options.concat(generateTimeWrongOptions(answer, 3));
                                        options = options.concat(uniqueAllDurations.filter(val => cleanText(val) !== cleanText(answer)).sort(() => Math.random() - 0.5).slice(0, 2));
                                    } else {
                                        const allBasicInfoValues = allPromos.flatMap(p => p.basicInfo ? Object.values(p.basicInfo).map(cleanText) : []).filter(Boolean);
                                        options = options.concat(generateGeneralWrongOptions(answer, allBasicInfoValues, 3));
                                    }
                                    options = options.sort(() => Math.random() - 0.5);
                                    const correctIndex = options.indexOf(answer);
                                    if (correctIndex !== -1 && options.length > 1) {
                                        dynamicQuizzes.push({
                                            question: question,
                                            options: options,
                                            correct: correctIndex,
                                            explanation: `${promo.title} promosyonunda "${key}", ${answer} olarak belirtilmiştir.`
                                        });
                                        existingQuestions.add(cleanText(question));
                                    }
                                }
                            }
                        }
                    }
                }
            }
            return dynamicQuizzes;
        }

        let askedQuizIndices = {}; // Her promosyon için sorulan quiz indekslerini tutacak

        async function loadPromosData() {
            try {
                const promoFiles = [
                    'ertesi-gun.json',
                    'bonus-buy.json',
                    'hos-geldin.json',
                    'spor-freebet.json',
                    'casino-kayip-bonusu.json',
                    'freespin-600.json',
                    'cash-out.json',
                    'futbol-2-gol-onde-kazan.json',
                    'basketbol-20-sayi-onde-kazan.json',
                    'yeni-uyelere-deneme-bonusu.json',
                    'spor-kayip-bonusu.json',
                    'spor-hos-geldin-bonusu.json',
                    'blackjack-21-bonus.json'
                ];

                const providerPromoFiles = [
                    'pragmatic-play.json',
                    'kalamba-cash-drop.json',
                    'evoplay-big-adventures.json'
                ];

                regularPromos = [];
                providerPromos = [];

                // Normal promosyonları yükle
                for (const file of promoFiles) {
                    try {
                        const promoResponse = await fetch(`../promosyonlar/${file}`);
                        if (promoResponse.ok) {
                            const promo = await promoResponse.json();
                            if (promo.id !== 'pragmatic-play' && promo.id !== 'kalamba-cash-drop' && promo.id !== 'evoplay-big-adventures') { // Sağlayıcı promosyonlarını burada yüklemeyi engelle
                                regularPromos.push(promo);
                            }
                        }
                    } catch (error) {
                        console.error(`Error loading regular promo ${file}:`, error);
                    }
                }

                // Sağlayıcı promosyonlarını yükle
                for (const file of providerPromoFiles) {
                    try {
                        const promoResponse = await fetch(`../promosyonlar/${file}`);
                        if (promoResponse.ok) {
                            const promo = await promoResponse.json();
                            providerPromos.push(promo);
                        }
                    } catch (error) {
                        console.error(`Error loading provider promo ${file}:`, error);
                    }
                }

                // Başlangıçta aktif promosyonları ayarla ve select box'ı güncelle
                showQuizCategory(currentQuizCategory);
            } catch (error) {
                console.error('Error loading all promos data:', error);
            }
        }

        function updatePromoSelect() {
            const select = document.getElementById('promo-select');
            select.innerHTML = '<option value="">Promosyon seçin...</option>';
            
            activePromos.forEach(promo => {
                // Hem manuel hem de dinamik olarak oluşturulan quizlerin varlığını kontrol et
                const hasManualQuizzes = promo.quiz && (Array.isArray(promo.quiz) && promo.quiz.length > 0 || typeof promo.quiz === 'object' && Object.keys(promo.quiz).length > 0);
                const dynamicQuizzes = generateQuizQuestions(promo);
                const hasDynamicQuizzes = dynamicQuizzes.length > 0;

                if (hasManualQuizzes || hasDynamicQuizzes) {
                    const option = document.createElement('option');
                    option.value = promo.id;
                    option.textContent = promo.title;
                    select.appendChild(option);
                }
            });
        }

        function showQuizCategory(category) {
            currentQuizCategory = category;

            // Tab butonlarının stilini güncelle
            document.querySelectorAll('.quiz-category-tab').forEach(tab => {
                tab.style.background = '#1a3a6b';
                tab.style.color = '#ffffff';
                tab.classList.remove('active');
            });

            const activeTab = document.getElementById(`tab-${category}`);
            activeTab.style.background = '#ffc107';
            activeTab.style.color = '#0a1f44';
            activeTab.classList.add('active');

            // Aktif promosyon listesini ayarla
            if (category === 'promosyon') {
                activePromos = regularPromos;
            } else if (category === 'saglayici') {
                activePromos = providerPromos;
            }

            // Promosyon seçimini ve quiz içeriğini sıfırla
            document.getElementById('promo-select').value = '';
            document.getElementById('quiz-content').style.display = 'none';
            document.getElementById('score-display').style.display = 'none';

            updatePromoSelect(); // Yeni listeye göre seçim kutusunu güncelle
        }

        function loadQuiz() {
            const selectedPromo = document.getElementById('promo-select').value;
            if (!selectedPromo) {
                document.getElementById('quiz-content').style.display = 'none';
                return;
            }

            const promo = activePromos.find(p => p.id === selectedPromo);
            if (!promo) {
                document.getElementById('quiz-content').style.display = 'none';
                alert('Bu promosyon için quiz bulunamadı!');
                return;
            }
            
            let allQuizzes = [];

            // Mevcut (manuel olarak eklenmiş) quizleri ekle
            if (promo.quiz) {
                allQuizzes = allQuizzes.concat(Array.isArray(promo.quiz) ? promo.quiz : [promo.quiz]);
            }
            
            // Dinamik olarak oluşturulan quizleri ekle
            const dynamicQuizzes = generateQuizQuestions(promo);
            allQuizzes = allQuizzes.concat(dynamicQuizzes);

            if (allQuizzes.length === 0) {
                document.getElementById('quiz-content').style.display = 'none';
                alert('Bu promosyon için quiz bulunamadı!');
                return;
            }

            // Bu promosyon için daha önce sorulan quiz indekslerini al
            if (!askedQuizIndices[selectedPromo]) {
                askedQuizIndices[selectedPromo] = [];
            }

            let availableQuizIndices = Array.from({ length: allQuizzes.length }, (_, i) => i);
            availableQuizIndices = availableQuizIndices.filter(index => !askedQuizIndices[selectedPromo].includes(index));

            if (availableQuizIndices.length === 0) {
                alert('Bu promosyon için tüm soruları yanıtladınız! Sorular tekrar edecektir.');
                askedQuizIndices[selectedPromo] = []; // Sorular bittiğinde listeyi sıfırla
                availableQuizIndices = Array.from({ length: allQuizzes.length }, (_, i) => i); // Tüm soruları tekrar kullanılabilir yap
            }

            const randomAvailableIndex = Math.floor(Math.random() * availableQuizIndices.length);
            const selectedQuizIndex = availableQuizIndices[randomAvailableIndex];

            currentQuiz = allQuizzes[selectedQuizIndex];
            askedQuizIndices[selectedPromo].push(selectedQuizIndex); // Sorulan soruyu işaretle
            
            document.getElementById('quiz-content').style.display = 'block';
            
            document.getElementById('quiz-question').textContent = currentQuiz.question;
            
            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';
            
            currentQuiz.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'quiz-option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(optionDiv, index);
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('score-display').style.display = 'none';
            document.getElementById('check-btn').disabled = false;
            currentAnswer = -1;
        }

        function selectOption(element, answerIndex) {
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.classList.remove('selected');
                option.classList.remove('correct');
                option.classList.remove('incorrect');
            });
            
            element.classList.add('selected');
            currentAnswer = answerIndex;
        }

        function checkAnswer() {
            if (currentAnswer === -1) {
                alert('Lütfen bir seçenek seçin!');
                return;
            }

            if (!currentQuiz) return;

            const options = document.querySelectorAll('.quiz-option');
            
            options[currentQuiz.correct].classList.add('correct');
            
            if (currentAnswer !== currentQuiz.correct) {
                options[currentAnswer].classList.add('incorrect');
            }

            document.getElementById('check-btn').disabled = true;
            
            const scoreDisplay = document.getElementById('score-display');
            const scoreText = document.getElementById('score-text');
            
            if (currentAnswer === currentQuiz.correct) {
                scoreText.innerHTML = `🎉 Tebrikler! Doğru cevap!<br><small>${currentQuiz.explanation}</small>`;
                scoreText.style.color = '#28a745';
            } else {
                scoreText.innerHTML = `❌ Yanlış cevap. Doğru cevap: ${currentQuiz.options[currentQuiz.correct]}<br><small>${currentQuiz.explanation}</small>`;
                scoreText.style.color = '#dc3545';
            }
            
            scoreDisplay.style.display = 'block';
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadPromosData();
        });
    </script>
</body>
</html>
